import{r as A,j as f,L as jt}from"./index-C9f9U4S0.js";import{P as c}from"./phaser-B61OQUcB.js";import{O as w,a as y}from"./sprite-C-W06VFL.js";const Yt=2e4,V=100,U=14,z=100,j=5,ct=V*.4,T=U,lt=5,dt=z*.05,M=20,K=2,P=U*2,N=260,Xt=M*K,Kt=1.3,_={weapon_damage:{}};function qt(o){localStorage.setItem("hordes-save-file",JSON.stringify(o))}function _t(){return JSON.parse(localStorage.getItem("hordes-save-file")??"{}")}function $t(){const o=_t(),t=o.totalDamageByWeapon??{};t.sword=(t.sword??0)+_.weapon_damage.sword,t.aura=(t.aura??0)+_.weapon_damage.aura,t.bomb=(t.bomb??0)+_.weapon_damage.bomb,t.pistol=(t.pistol??0)+_.weapon_damage.pistol,o.totalDamageByWeapon=t,qt(o)}function Jt(){const o=_t();return[...Object.keys(St).filter(t=>St[t](o)).filter(t=>t!=null).map(t=>t+":unlocked")]}const St={sword:o=>o.totalDamageByWeapon?.sword??!1,swordMk2:o=>o.totalDamageByWeapon?.sword??!1,swordMk3:o=>o.totalDamageByWeapon?.sword??!1,swordMk4:o=>o.totalDamageByWeapon?.sword??!1,swordMk5:o=>o.totalDamageByWeapon?.sword??!1,pistol:o=>o.totalDamageByWeapon?.pistol??!1,pistolMk2:o=>o.totalDamageByWeapon?.pistol??!1,pistolMk3:o=>o.totalDamageByWeapon?.pistol??!1,pistolMk4:o=>o.totalDamageByWeapon?.pistol??!1,pistolMk5:o=>o.totalDamageByWeapon?.pistol??!1,bomb:o=>o.totalDamageByWeapon?.bomb??!1,bombMk2:o=>o.totalDamageByWeapon?.bomb??!1,bombMk3:o=>o.totalDamageByWeapon?.bomb??!1,bombMk4:o=>o.totalDamageByWeapon?.bomb??!1,bombMk5:o=>o.totalDamageByWeapon?.bomb??!1,aura:o=>o.totalDamageByWeapon?.aura??!1,auraMk2:o=>o.totalDamageByWeapon?.aura??!1,auraMk3:o=>o.totalDamageByWeapon?.aura??!1,auraMk4:o=>o.totalDamageByWeapon?.aura??!1,auraMk5:o=>o.totalDamageByWeapon?.aura??!1},Zt=T*2;function Qt(o,t){const e=t?.frame??y.hero,s=o.add.sprite(0,0,w.key,e);return s.setOrigin(.5),s.setDisplaySize(U*2,U*2),s.setTint(t?.tint??5025616),s.setDepth(.2),s.setData("radius",U),{sprite:s,radius:U,maxHp:z,hp:z,upgrades:[...Jt()],weaponIds:[],direction:new c.Math.Vector2(0,0),areaMultiplier:1,damageMultiplier:1}}function te(o,t,e,s){o.sprite.x+=t.x*e*s,o.sprite.y+=t.y*e*s,t.lengthSq()>1e-4&&o.direction.copy(t)}function ee(o,t){return o.hp=Math.max(0,o.hp-t),o.hp}function se(o,t){return o.hp=Math.min(o.maxHp,o.hp+t),o.hp}function O(o){return{damage:Math.ceil(o.damage??j),cooldown:Math.ceil((o.cooldown??2)*10)/10,area:Math.ceil(o.area??0),pierce:Math.ceil(o.pierce??0),sectorAngle:Math.ceil(o.sectorAngle??120)}}const mt=O({damage:j,cooldown:.5,pierce:1,area:6}),nt=o=>O({...o,damage:o.damage*1.1,cooldown:o.cooldown*.9,pierce:o.pierce+1}),q=nt(mt),$=nt(q),J=nt($),It=nt(J),ft=O({damage:j,cooldown:1,area:Zt}),rt=o=>O({...o,damage:o.damage*1.1,cooldown:o.cooldown*.9,area:o.area*1.2}),Z=rt(ft),Q=rt(Z),tt=rt(Q),Tt=rt(tt),yt=O({cooldown:5,damage:j*4,area:100}),Nt=o=>O({...o,damage:o.damage*1.3,cooldown:o.cooldown*.7,area:o.area*1.2}),et=Nt(yt),Lt=Nt(et),wt=O({cooldown:1.2,damage:j*2,area:50,sectorAngle:120}),ht=o=>O({...o,damage:o.damage*1.1,cooldown:o.cooldown*.9,area:o.area+10,sectorAngle:o.sectorAngle+10}),st=ht(wt),it=ht(st),at=ht(it),Rt=ht(at),ie={sword:[wt,st,it,at,Rt],aura:[ft,Z,Q,tt,Tt],bomb:[yt,et,Lt],pistol:[mt,q,$,J,It]},pt=[{id:"aura",label:"Unlock Aura",description:"Activate a damaging circle around you.",requires:["aura:unlocked"],category:"WEAPON_NEW",weaponId:"aura",level:1},{id:"auraMk2",label:"Aura Mk II",description:k(ft,Z),requires:["aura","auraMk2:unlocked"],category:"WEAPON_UPGRADE",weaponId:"aura",level:2},{id:"auraMk3",label:"Aura Mk III",description:k(Z,Q),requires:["auraMk2","auraMk3:unlocked"],category:"WEAPON_UPGRADE",weaponId:"aura",level:3},{id:"auraMk4",label:"Aura Mk IV",description:k(Q,tt),requires:["auraMk3","auraMk4:unlocked"],category:"WEAPON_UPGRADE",weaponId:"aura",level:4},{id:"auraMk5",label:"Aura Mk V",description:k(tt,Tt),requires:["auraMk4","auraMk5:unlocked"],category:"WEAPON_UPGRADE",weaponId:"aura",level:5},{id:"pistol",label:"Equip Pistol",description:"Basic ranged damage with moderate fire rate.",requires:["pistol:unlocked"],category:"WEAPON_NEW",weaponId:"pistol",level:1},{id:"pistolMk2",label:"Pistol Mk II",description:k(mt,q),requires:["pistol","pistolMk2:unlocked"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:2},{id:"pistolMk3",label:"Pistol Mk III",description:k(q,$),requires:["pistolMk2","pistolMk3:unlocked"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:3},{id:"pistolMk4",label:"Pistol Mk IV",description:k($,J),requires:["pistolMk3","pistolMk4:unlocked"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:4},{id:"pistolMk5",label:"Pistol Mk V",description:k(J,It),requires:["pistolMk4","pistolMk5:unlocked"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:5},{id:"bomb",label:"Deploy Bombs",description:"Drop timed explosives dealing area damage.",requires:["bomb:unlocked"],category:"WEAPON_NEW",weaponId:"bomb",level:1},{id:"bombMk2",label:"Bombs Mk II",description:k(yt,et),requires:["bomb","bombMk2:unlocked"],category:"WEAPON_UPGRADE",weaponId:"bomb",level:2},{id:"bombMk3",label:"Bombs Mk III",description:k(et,Lt),requires:["bombMk2","bombMk3:unlocked"],category:"WEAPON_UPGRADE",weaponId:"bomb",level:3},{id:"sword",label:"Equip Sword",description:"Unlock a melee sword slash in your movement direction.",requires:["sword:unlocked"],category:"WEAPON_NEW",weaponId:"sword",level:1},{id:"swordMk2",label:"Sword Mk II",description:k(wt,st),requires:["sword","swordMk2:unlocked"],category:"WEAPON_UPGRADE",weaponId:"sword",level:2},{id:"swordMk3",label:"Sword Mk III",description:k(st,it),requires:["swordMk2","swordMk3:unlocked"],category:"WEAPON_UPGRADE",weaponId:"sword",level:3},{id:"swordMk4",label:"Sword Mk IV",description:k(it,at),requires:["swordMk3","swordMk4:unlocked"],category:"WEAPON_UPGRADE",weaponId:"sword",level:4},{id:"swordMk5",label:"Sword Mk V",description:k(at,Rt),requires:["swordMk4","swordMk5:unlocked"],category:"WEAPON_UPGRADE",weaponId:"sword",level:5},{id:"area1",label:"Area +10%",description:"Increase area of effect by 10%",category:"PASSIVE_NEW",level:1},{id:"damage1",label:"Damage +10%",description:"Increase all weapon damage by 10%.",category:"PASSIVE_NEW",level:1}];function k(o,t){return[o.damage!==t.damage&&`DMG ${o.damage}→${t.damage}`,o.cooldown!==t.cooldown&&`Cooldown ${o.cooldown}→${t.cooldown}`,o.area!==t.area&&`Area ${o.area}→${t.area}`,o.pierce!==t.pierce&&`Pierce ${o.pierce}→${t.pierce}`,o.sectorAngle!==t.sectorAngle&&`Angle ${o.sectorAngle}→${t.sectorAngle}`].filter(Boolean).reduce((e,s)=>s?`${e} ${s}`:e,"")}const bt=.8,Mt=.3;class Et{id=()=>"sword";swordElapsed=0;activeSwordSwing=null;scene;context;damageEnemy;stats;constructor(t,e,s,i){this.scene=t,this.context=e,this.stats=s,this.damageEnemy=i}update(t,e,s){this.activeSwordSwing&&this.updateActiveSwordSwing(t,e);const i=this.context.hero;if(i.hp<=0||(this.swordElapsed+=t,this.activeSwordSwing)||this.swordElapsed<this.stats.cooldown)return;const a=i.direction;if(!a||a.lengthSq()<1e-4)return;this.swordElapsed=0;const r=a.clone().normalize(),h={prepGfx:null,strikeGfx:null,angleDeg:c.Math.RadToDeg(Math.atan2(r.y,r.x)),prepRemaining:Mt,strikeRemaining:bt,hitEnemies:new Set,cleanup:()=>{h.cleaned||(h.cleaned=!0,this.scene.events.off(c.Scenes.Events.POST_UPDATE,h.followHero),this.scene.events.off(c.Scenes.Events.SHUTDOWN,h.cleanup),h.prepGfx?.destroy(),h.strikeGfx?.destroy(),this.activeSwordSwing===h&&(this.activeSwordSwing=null))},followHero:()=>{const l=this.context.hero.sprite;h.prepGfx?.setPosition(l.x,l.y),h.strikeGfx?.setPosition(l.x,l.y)},cleaned:!1};this.scene.events.on(c.Scenes.Events.POST_UPDATE,h.followHero),this.scene.events.once(c.Scenes.Events.SHUTDOWN,h.cleanup),this.activeSwordSwing=h,this.spawnPrepGraphics(h)}destroy(){this.swordElapsed=0,this.activeSwordSwing&&(this.activeSwordSwing.cleanup(),this.activeSwordSwing=null)}updateActiveSwordSwing(t,e){const s=this.activeSwordSwing;if(!s)return;let i=t;if(s.prepRemaining>0){const n=this.context.hero.direction;n&&n.lengthSq()>1e-4&&(s.angleDeg=c.Math.RadToDeg(Math.atan2(n.y,n.x)),this.updatePrepGraphics(s));const h=Math.min(s.prepRemaining,i);if(s.prepRemaining-=h,i-=h,s.prepRemaining<=0&&!s.strikeGfx&&this.beginStrikePhase(s),i<=0)return}else s.strikeGfx||this.beginStrikePhase(s);if(s.strikeRemaining-=i,s.strikeRemaining<=0){s.cleanup(),this.activeSwordSwing=null;return}const r=this.context.hero.sprite;for(const n of e){if(s.hitEnemies.has(n))continue;const h=n.getData("mob");if(!n.active||!h)continue;const l=n.x-r.x,p=n.y-r.y;if(Math.hypot(l,p)>this.stats.area+h.size/2)continue;const g=c.Math.RadToDeg(Math.atan2(p,l)),u=c.Math.Angle.ShortestBetween(s.angleDeg,g);Math.abs(u)>this.stats.sectorAngle/2||(s.hitEnemies.add(n),this.damageEnemy(n,this.stats.damage,h))}}spawnPrepGraphics(t){const e=this.context.hero.sprite,s=this.scene.add.graphics({x:e.x,y:e.y});s.setDepth(-.35),s.setAlpha(.8),s.fillStyle(16777215,.5),s.beginPath();const i=c.Math.DegToRad(this.stats.sectorAngle/2);s.slice(0,0,this.stats.area,-i,i,!1),s.fillPath(),s.setScale(.25),s.rotation=c.Math.DegToRad(t.angleDeg),t.prepGfx=s,t.followHero(),this.scene.tweens.add({targets:s,scaleX:1,scaleY:1,alpha:.1,ease:"Sine.easeOut",duration:Mt*1e3})}updatePrepGraphics(t){const e=t.prepGfx;!e||t.cleaned||(e.rotation=c.Math.DegToRad(t.angleDeg))}beginStrikePhase(t){t.prepGfx?.destroy(),t.prepGfx=null;const e=this.context.hero.sprite,s=this.scene.add.graphics({x:e.x,y:e.y});s.setDepth(-.3),s.setAlpha(.6),s.fillStyle(16766287,.35),s.beginPath();const i=c.Math.DegToRad(this.stats.sectorAngle/2);s.slice(0,0,this.stats.area,-i,i,!1),s.fillPath(),s.rotation=c.Math.DegToRad(t.angleDeg),t.strikeGfx=s,t.followHero(),this.scene.tweens.add({targets:s,alpha:0,scale:1.05,duration:bt*1e3,onComplete:()=>t.cleanup()})}}class kt{id=()=>"bomb";bombElapsed;bombs=[];scene;context;stats;damageEnemy;constructor(t,e,s,i){this.scene=t,this.context=e,this.stats=s,this.damageEnemy=i,this.bombElapsed=this.stats.cooldown}update(t,e,s){for(this.bombElapsed+=t;this.bombElapsed>=this.stats.cooldown;)this.bombElapsed-=this.stats.cooldown,this.spawnBomb(this.stats);const i=this.scene.time.now;this.bombs=this.bombs.filter(a=>{if(!a.sprite.active)return a.sprite.destroy(),!1;const{detonateAt:r}=a,n=r-i,h=vt;if(n<=0)return this.detonateBomb(a,e),!1;const l=1-n/h;return a.sprite.setAlpha(.6+Math.sin(l*Math.PI*4)*.2),!0})}spawnBomb(t){const{sprite:e}=this.context.hero,s=this.scene.add.image(e.x,e.y,w.key,y.bomb);s.setDepth(-.5),s.setDisplaySize(P,P),s.setTint(16740419),s.setAlpha(.9);const i=this.scene.time.now+vt;this.bombs.push({sprite:s,detonateAt:i,weapon:t})}detonateBomb(t,e){const{sprite:s,weapon:i}=t,a=this.scene.add.circle(s.x,s.y,i.area,16755520,.35);a.setDepth(-.4),this.scene.tweens.add({targets:a,alpha:0,scale:1.4,duration:320,onComplete:()=>a.destroy()});const r=i.area,n=i.damage;for(const h of e){const l=h.getData("mob");if(!h.active||!l)continue;c.Math.Distance.Between(s.x,s.y,h.x,h.y)<=r+l.size/2&&this.damageEnemy(h,n,l)}s.destroy()}destroy(){this.bombElapsed=0,this.bombs.forEach(t=>t.sprite.destroy()),this.bombs=[]}}const vt=2e3;class Dt{id=()=>"aura";scene;context;stats;damageEnemy;aura;constructor(t,e,s,i){this.scene=t,this.context=e,this.stats=s,this.damageEnemy=i,this.init()}init(){this.aura?.destroy();const t=this.scene.add.circle(this.context.hero.sprite.x,this.context.hero.sprite.y,this.stats.area,16771899,.1);t.setDepth(-1),t.setVisible(!0),this.aura=t}update(t,e,s){this.aura.setPosition(this.context.hero.sprite.x,this.context.hero.sprite.y),e.forEach(i=>{const a=i.getData("mob");if(!i.active||!a)return!1;const r=this.context.hero.sprite.x-i.x,n=this.context.hero.sprite.y-i.y,h=Math.hypot(r,n)||.001;this.applyAuraDamage(i,h,a)})}applyAuraDamage(t,e,s){if(e>this.stats.area+s.size/2)return!1;const i=this.scene.time.now,a=t.getData("lastAuraTick"),r=this.stats.cooldown*1e3;if(a&&i-a<r)return!1;t.setData("lastAuraTick",i),this.damageEnemy(t,this.stats.damage,s);const n=this.context.hero.sprite,h=t.x-n.x,l=t.y-n.y,p=Math.hypot(h,l)||1,d=t.getData("auraKnockback")??40,g=Math.max(d/2,5);t.setData("auraKnockback",g),t.x+=h/p*d,t.y+=l/p*d;const u=t.getData("hpText");u?.active&&u.setPosition(t.x,t.y-s.size/2-8)}destroy(){this.aura?.destroy()}}class At{id=()=>"pistol";scene;context;stats;damageEnemy;bullets=[];shootElapsed=0;constructor(t,e,s,i){this.scene=t,this.context=e,this.stats=s,this.damageEnemy=i}update(t,e,s){this.bullets=this.bullets.filter(i=>{const a=i.sprite;if(!a.active)return!1;if(a.x+=i.vx*t,a.y+=i.vy*t,a.x<s.left-N||a.x>s.right+N||a.y<s.top-N||a.y>s.bottom+N)return a.destroy(),!1;for(const r of e){const n=r.getData("mob");if(!(!r.active||!n)&&!i.hitEnemies.has(r)&&c.Math.Distance.Between(a.x,a.y,r.x,r.y)<n.size/2+i.radius&&(i.hitEnemies.add(r),this.damageEnemy(r,this.stats.damage,n),a.x+=i.vx*t*.3,a.y+=i.vy*t*.3,i.piercesLeft-=1,i.piercesLeft<=0))return a.destroy(),!1}return!0}),this.context.hero.hp>0&&this.tickAutoFire(t)}tickAutoFire(t){if(!this.context.getEnemies().some(g=>g.active)||(this.shootElapsed+=t,this.shootElapsed<this.stats.cooldown))return;this.shootElapsed=0;const s=this.findNearestEnemy();if(!s)return;const{sprite:i}=this.context.hero,a=s.x-i.x,r=s.y-i.y,n=Math.hypot(a,r);if(!n)return;const h=this.stats.area,l=this.scene.add.circle(i.x,i.y,h,11184810),p=a/n*Pt,d=r/n*Pt;this.bullets.push({sprite:l,vx:p,vy:d,radius:h,piercesLeft:this.stats.pierce,hitEnemies:new Set})}findNearestEnemy(){const{sprite:t}=this.context.hero,e=this.context.getEnemies();let s,i=Number.POSITIVE_INFINITY;for(const a of e){if(!a.active)continue;const r=c.Math.Distance.Between(t.x,t.y,a.x,a.y);r<i&&(s=a,i=r)}return s}destroy(){this.bullets.forEach(t=>t.sprite.destroy()),this.bullets=[],this.shootElapsed=0}}const Pt=V*3;class ae{scene;context;weapons=[];originalStats={};constructor(t,e){this.scene=t,this.context=e}destroy(){this.weapons.forEach(t=>t.destroy())}update(t,e){const s=this.context.getEnemies();this.weapons.forEach(i=>i.update(t,s,e))}refreshWeapons(){this.setPistolWeapon(this.originalStats.pistol??null),this.setBombWeapon(this.originalStats.bomb??null),this.setSwordWeapon(this.originalStats.sword??null),this.setAuraWeapon(this.originalStats.aura??null)}damageEnemy(t,e,s,i){if(!t.active)return!1;const a=t.getData("hp")??s.health,r=a-e;t.setData("hp",r);const n=t.getData("hpText");n?.active&&n.setText(`${Math.max(r,0)}`);const h=a-r;return _.weapon_damage[i]=(_.weapon_damage[i]??0)+h,r<=0?(this.context.onEnemyKilled(t,s),t.setActive(!1),t.destroy(),!0):!1}setPistolWeapon(t){if(!t){this.unsetWeapon("pistol");return}this.originalStats.pistol=t;const e=this.withModifiers(t);this.setWeapon(new At(this.scene,this.context,e,this.damageEnemyWithStats("pistol")))}damageEnemyWithStats=t=>(e,s,i)=>{this.damageEnemy(e,s,i,t)};setAuraWeapon(t){if(!t){this.unsetWeapon("aura");return}this.originalStats.aura=t;const e=this.withModifiers(t);this.setWeapon(new Dt(this.scene,this.context,e,this.damageEnemyWithStats("aura")))}setBombWeapon(t){if(!t){this.unsetWeapon("bomb");return}this.originalStats.bomb=t;const e=this.withModifiers(t);this.setWeapon(new kt(this.scene,this.context,e,this.damageEnemyWithStats("bomb")))}setSwordWeapon(t){if(!t){this.unsetWeapon("sword");return}this.originalStats.sword=t;const e=this.withModifiers(t);this.setWeapon(new Et(this.scene,this.context,e,this.damageEnemyWithStats("sword")))}setWeaponStats(t,e){if(!e){this.unsetWeapon(t);return}this.originalStats[t]=e;const s=this.withModifiers(e);this.setWeapon(this.createWeapon(t,s))}createWeapon(t,e){const s=this.damageEnemyWithStats(t);if(t=="sword")return new Et(this.scene,this.context,e,s);if(t=="aura")return new Dt(this.scene,this.context,e,s);if(t=="bomb")return new kt(this.scene,this.context,e,s);if(t=="pistol")return new At(this.scene,this.context,e,s);throw new Error(`Unknown weapon id ${t}`)}setWeapon(t){const e=this.weapons.findIndex(s=>s.id()===t.id());e>=0?(this.weapons[e].destroy(),this.weapons[e]=t):this.weapons.push(t)}unsetWeapon(t){const e=this.weapons.findIndex(s=>s.id()===t);e>=0&&(this.weapons[e].destroy(),this.weapons.splice(e,1),this.originalStats[t]=void 0)}withModifiers(t){const e=this.context.hero,s=e.areaMultiplier,i=e.damageMultiplier;return O({...t,area:t.area*s,damage:t.damage*i})}}const I=68,oe=4;function ne(o){const t=o.input.keyboard.createCursorKeys(),e=new c.Math.Vector2,s=new c.Math.Vector2;let i,a,r;const n=46,h=20,l=()=>{i&&a||(i=o.add.circle(120,o.scale.height-120,n,16777215,.1),i.setStrokeStyle(2,16777215,.35),i.setScrollFactor(0),i.setDepth(5),i.setVisible(!1),a=o.add.circle(i.x,i.y,h,16777215,.35),a.setScrollFactor(0),a.setDepth(6),a.setVisible(!1))},p=()=>{r=void 0,e.set(0,0),i&&a&&(a.setPosition(i.x,i.y),i.setVisible(!1),a.setVisible(!1))},d=m=>{r===void 0&&m.primaryDown&&(l(),!(!i||!a)&&(r=m.id,i.setPosition(m.x,m.y),a.setPosition(m.x,m.y),i.setVisible(!0),a.setVisible(!0),e.set(0,0)))},g=m=>{if(r!==m.id||!i||!a)return;const E=m.x-i.x,x=m.y-i.y,v=Math.hypot(E,x);if(v<=I)a.setPosition(m.x,m.y),e.set(E/I,x/I);else{const H=Math.atan2(x,E),F=Math.cos(H)*I,G=Math.sin(H)*I;a.setPosition(i.x+F,i.y+G),e.set(F/I,G/I)}v<oe&&e.set(0,0)},u=m=>{r===m.id&&p()};return o.input.on("pointerdown",d),o.input.on("pointermove",g),o.input.on("pointerup",u),o.input.on("pointerupoutside",u),{cursors:t,getDirection(){s.copy(e),t.left.isDown&&(s.x-=1),t.right.isDown&&(s.x+=1),t.up.isDown&&(s.y-=1),t.down.isDown&&(s.y+=1);const m=s.length();return m>1&&s.scale(1/m),s.clone()},destroy(){p(),o.input.off("pointerdown",d),o.input.off("pointermove",g),o.input.off("pointerup",u),o.input.off("pointerupoutside",u),i?.destroy(),a?.destroy(),i=void 0,a=void 0,r=void 0}}}const re=P*4,he=P,Ot=V*1.5,Ht=100,R=P*.5;class ce{scene;crystals=[];constructor(t){this.scene=t}spawn(t,e,s){const i=Math.max(1,Math.round(s)),a=c.Math.FloatBetween(-6,6),r=c.Math.FloatBetween(-6,6),n=this.scene.add.polygon(t+a,e+r,[0,-R,R,0,0,R,-R,0],6600182,.7);n.setOrigin(.5),n.setDepth(-.2),n.setStrokeStyle(1.2,16777215,.5),n.setData("xp",i),n.setData("baseSize",R),n.setData("magnetized",!1),n.setData("magnetSpeed",Ot),this.updateCrystalVisual(n),this.crystals.push(n)}update(t,e,s,i){const a=c.Math.Clamp(this.scene.game.loop.delta,8,48)/1e3;this.crystals=this.crystals.filter(r=>{if(!r.active)return r.destroy(),!1;r.getData("magnetized")||c.Math.Distance.Between(r.x,r.y,t,e)<=re&&r.setData("magnetized",!0);const h=r.getData("magnetized");if(h){const p=r.getData("magnetSpeed")??Ot,d=t-r.x,g=e-r.y,u=Math.hypot(d,g)||1e-4,m=p*a;r.x+=d/u*m,r.y+=g/u*m}const l=c.Math.Distance.Between(r.x,r.y,t,e);if(h&&l<=he){const p=Math.max(1,Math.round(r.getData("xp")??0));return r.destroy(),p>0&&i(p),!1}return!0}),this.mergeOutOfBounds(s,t,e)}destroyAll(){this.crystals.forEach(t=>t.destroy()),this.crystals=[]}activateMagnet(){this.crystals.forEach(t=>{t.active&&t.setData("magnetized",!0)})}mergeOutOfBounds(t,e,s){if(this.crystals.length<=Ht)return;const i=N;let a=0;for(;this.crystals.length>Ht&&a<20;){const r=this.crystals.filter(d=>d.x<t.left-i||d.x>t.right+i||d.y<t.top-i||d.y>t.bottom+i);if(r.length<2)break;r.sort((d,g)=>{const u=c.Math.Distance.Between(e,s,d.x,d.y);return c.Math.Distance.Between(e,s,g.x,g.y)-u});const n=r[0],h=r[1];if(!n.active||!h.active){[n,h].forEach(d=>{d.active||(d.destroy(),this.crystals=this.crystals.filter(g=>g!==d))}),a+=1;continue}const l=Math.max(0,Math.round(n.getData("xp")??0)),p=Math.max(0,Math.round(h.getData("xp")??0));n.setData("xp",l+p),n.setPosition((n.x+h.x)/2,(n.y+h.y)/2),this.updateCrystalVisual(n),h.destroy(),this.crystals=this.crystals.filter(d=>d!==h),a+=1}}updateCrystalVisual(t){const e=t.getData("xp")??0,s=t.getData("baseSize")??R,i=c.Math.Clamp(6+Math.sqrt(e)*1.1,6,28),a=i/s;t.setScale(a),t.setData("radius",i);const r=c.Math.Clamp(.45+e/180,.45,.9);t.setFillStyle(6600182,r),t.setStrokeStyle(1.2,16777215,.45+Math.min(.4,e/120))}}class le{scene;enemies;spawnBuffer=T*6;constructor(t,e){this.scene=t,this.enemies=e}spawn(t,e,s){const i=e.size/2,{x:a,y:r}=this.findSpawnPosition(t,i),n=s.frame??y.mobWalk1,h=this.scene.add.sprite(a,r,w.key,n);return h.setOrigin(.5),h.setDisplaySize(e.size,e.size),h.setTint(s.color),h.setDepth(.1),h.setActive(!0),h.setData("mob",e),h.setData("hp",e.health),h.setData("lastHit",0),h.setData("lastAuraTick",0),h.setData("auraKnockback",40),h.setData("radius",i),!s.frame&&this.scene.anims.exists("enemy-walk")&&(h.play("enemy-walk"),h.anims.setProgress(Math.random())),this.enemies.push(h),this.attachHpLabel(h,e),h}attachHpLabel(t,e){D.create(this.scene,t,e)}resolveOverlaps(){for(let t=0;t<this.enemies.length;t+=1){const e=this.enemies[t];if(!e.active)continue;const s=e.getData("mob");if(!s)continue;const i=s.size/2;for(let a=t+1;a<this.enemies.length;a+=1){const r=this.enemies[a];if(!r.active)continue;const n=r.getData("mob");if(!n)continue;const h=n.size/2,l=r.x-e.x,p=r.y-e.y,d=Math.hypot(l,p),g=i+h+2;if(d===0){const u=c.Math.FloatBetween(0,Math.PI*2);e.x+=Math.cos(u),e.y+=Math.sin(u),r.x-=Math.cos(u),r.y-=Math.sin(u),D.update(e,s),D.update(r,n);continue}if(d<g){const u=(g-d)/2,m=l/d,E=p/d;e.x-=m*u,e.y-=E*u,r.x+=m*u,r.y+=E*u,D.update(e,s),D.update(r,n)}}}}update(t,e,s,i){return this.enemies=this.enemies.filter(a=>this.updateEnemyState(a,t,e,s,i)),this.enemies}updateEnemyState(t,e,s,i,a){const r=t.getData("mob");if(!t.active||!r)return!1;const n=this.moveEnemyTowardsHero(t,r,e,s);return D.update(t,r),n<e.radius+r.size/2&&a(t,r),this.shouldCullEnemy(t,r.size/2,i)?(t.destroy(),!1):t.active}moveEnemyTowardsHero(t,e,s,i){const a=s.sprite.x-t.x,r=s.sprite.y-t.y,n=Math.hypot(a,r)||.001,h=e.speed;return t.x+=a/n*h*i,t.y+=r/n*h*i,a!==0&&t.setFlipX(a<0),n}shouldCullEnemy(t,e,s){const i=N+e;return t.x<s.left-i||t.x>s.right+i||t.y<s.top-i||t.y>s.bottom+i}findSpawnPosition(t,e){const i=this.scene.cameras.main.worldView;let a={x:i.centerX,y:i.y};const r=12;for(let n=0;n<r;n+=1){let h=0,l=0;switch(t){case 0:h=i.centerX+c.Math.FloatBetween(-i.width/2,i.width/2),l=i.top-this.spawnBuffer;break;case 1:h=i.right+this.spawnBuffer,l=i.centerY+c.Math.FloatBetween(-i.height/2,i.height/2);break;case 2:h=i.centerX+c.Math.FloatBetween(-i.width/2,i.width/2),l=i.bottom+this.spawnBuffer;break;default:h=i.left-this.spawnBuffer,l=i.centerY+c.Math.FloatBetween(-i.height/2,i.height/2);break}if(h+=c.Math.FloatBetween(-e,e),l+=c.Math.FloatBetween(-e,e),a={x:h,y:l},this.isPositionClear(h,l,e))break}return a}isPositionClear(t,e,s){for(const a of this.enemies){if(!a.active)continue;const r=a.getData("mob");if(!r)continue;const n=r.size/2;if(c.Math.Distance.Between(t,e,a.x,a.y)<s+n+6)return!1}return!0}}class D{static DATA_KEY="hpText";static create(t,e,s){const i=t.add.text(e.x,e.y,`${s.health}`,{color:"#ffffff",fontFamily:"monospace",fontSize:"12px"}).setOrigin(.5).setDepth(1);e.setData(D.DATA_KEY,i),e.once("destroy",()=>i.destroy()),D.update(e,s)}static update(t,e){const s=D.get(t);s?.active&&s.setPosition(t.x,t.y-e.size/2-8)}static get(t){return t.getData(D.DATA_KEY)}}class de{scene;enemyManager;hooks;wave=0;running=!1;waveTimer;constructor(t,e,s){this.scene=t,this.enemyManager=e,this.hooks=s}start(){this.running||(this.running=!0,this.spawnWave(),this.waveTimer=this.scene.time.addEvent({delay:5e3,callback:this.spawnWave,callbackScope:this,loop:!0,startAt:0}))}stop(){this.running&&(this.running=!1,this.waveTimer?.remove(),this.waveTimer=void 0,this.wave=0)}isRunning(){return this.running}destroy(){this.stop()}spawnWave=()=>{if(!this.hooks.getHero())return;if(this.wave+=1,Bt.length<=this.wave){this.gameover();return}this.hooks.onWaveAdvanced(this.wave);const e=Bt[this.wave],s=c.Math.Between(0,3);for(const i of e.mobs){const a=i.amount,r=i.stats,n=i.appearance;for(let h=0;h<a;h+=1){if(h<a*.1){this.spawnEnemy(s+1,r,n);continue}if(h<a*.2){this.spawnEnemy(s+2,r,n);continue}if(h<a*.5){this.spawnEnemy(s+3,r,n);continue}this.spawnEnemy(s,r,n)}}};spawnEnemy(t,e,s){t=t%4,this.enemyManager.spawn(t,e,s)}gameover(){this.stop(),this.scene.game.events.emit("wavesOver")}}const S={default:{frame:y.mobWalk1,color:5292096},strong:{frame:y.enemy1,color:12603456},elite:{frame:y.enemy2,color:7389200},reaper:{frame:y.scull,color:13643840}},b={default:{size:T*2,speed:ct,health:lt,xp:K,damage:dt},strong:{size:T*2.5,speed:ct,health:lt*3,xp:K*2,damage:dt*1.5},elite:{size:T*3,speed:ct,health:lt*5,xp:K*4,damage:dt*2.5},reaper:{size:T*3,speed:V*2,health:1e4,xp:0,damage:z/2}},Bt=[...ut(3,{mobs:[{stats:b.default,appearance:S.default,amount:M}]}),{mobs:[{stats:b.default,appearance:S.default,amount:M},{stats:b.strong,appearance:S.strong,amount:M/5}]},{mobs:[{stats:b.default,appearance:S.default,amount:M},{stats:b.strong,appearance:S.strong,amount:M/4}]},{mobs:[{stats:b.default,appearance:S.default,amount:M},{stats:b.strong,appearance:S.strong,amount:M/3}]},{mobs:[{stats:b.default,appearance:S.default,amount:M},{stats:b.strong,appearance:S.strong,amount:M/2}]},{mobs:[{stats:b.default,appearance:S.default,amount:M},{stats:b.strong,appearance:S.strong,amount:M}]},{mobs:[{stats:b.default,appearance:S.default,amount:M},{stats:b.strong,appearance:S.strong,amount:M},{stats:b.elite,appearance:S.elite,amount:M/4}]},...ut(13,{mobs:[{stats:b.strong,appearance:S.strong,amount:M},{stats:b.elite,appearance:S.elite,amount:M/2}]}),...ut(3,{mobs:[{stats:b.default,appearance:S.default,amount:1}]}),{mobs:[{stats:b.reaper,appearance:S.reaper,amount:3}]}];function ut(o,t){const e=[];for(let s=0;s<o;s+=1)e.push(t);return e}class pe{scene;hero;combat;hooks;overlay=[];active=!1;constructor(t,e,s,i){this.scene=t,this.hero=e,this.combat=s,this.hooks=i}isActive(){return this.active}openMenu(){if(this.active)return!0;const t=this.getAvailableUpgrades();if(!t.length)return!1;this.active=!0,this.hooks.onMenuOpened(),this.clearOverlay();const{width:e,height:s}=this.scene.scale,i=e/2,a=s/2,r=Math.min(e-80,420),n=84,h=t.length*n+140,l=this.scene.add.rectangle(i,a,e,s,0,.55).setScrollFactor(0).setDepth(10).setInteractive();this.overlay.push(l);const p=this.scene.add.rectangle(i,a,r,h,2302778,.96).setScrollFactor(0).setDepth(11).setStrokeStyle(2,16771899,.5);this.overlay.push(p);const g=this.scene.add.text(i,a-h/2+40,"Choose Upgrade",{color:"#ffe082",fontFamily:"monospace",fontSize:"22px"}).setOrigin(.5).setScrollFactor(0).setDepth(12);return this.overlay.push(g),t.forEach((u,m)=>{const E=a-h/2+88+m*n,x=this.scene.add.text(i,E,u.label,{color:"#f5f5f5",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#30304a",padding:{x:16,y:10}}).setOrigin(.5).setScrollFactor(0).setDepth(12).setInteractive({useHandCursor:!0});x.on("pointerover",()=>x.setStyle({backgroundColor:"#3d3d5c"})),x.on("pointerout",()=>x.setStyle({backgroundColor:"#30304a"})),x.on("pointerdown",()=>this.applyUpgrade(u.id)),this.overlay.push(x);const v=this.scene.add.text(i,E+28,u.description,{color:"#b0bec5",fontFamily:"monospace",fontSize:"16px"}).setOrigin(.5,0).setScrollFactor(0).setDepth(12);this.overlay.push(v)}),!0}destroy(){this.clearOverlay()}applyUpgrade(t){this.hero.upgrades.includes(t)||this.hero.upgrades.push(t);const e=pt.find(s=>s.id===t);switch(e?.weaponId&&e.level&&this.applyWeaponUpgrade(e,ie[e.weaponId][e.level-1],e.description),t){case"area1":this.applyAreaUpgrade();break;case"damage1":this.applyDamageUpgrade();break}this.hooks.onUpgradeApplied(),this.closeMenu()}closeMenu(){this.clearOverlay(),this.active=!1,this.hooks.onMenuClosed()}clearOverlay(){this.overlay.forEach(t=>t.destroy()),this.overlay=[]}getAvailableUpgrades(){const t=this.hero.weaponIds.length===0,e=pt.filter(n=>this.hero.upgrades.includes(n.id)||!(n.requires?.every(h=>this.hero.upgrades.includes(h))??!0)||n.weaponId&&n.level&&n.level>1&&!!!this.hero.upgrades.find(l=>{const p=pt.find(d=>d.id===l);return p?.level===n.level-1&&p.weaponId===n.weaponId})?!1:t?n.category==="WEAPON_NEW":!0);function s(n){return n.length>0?n[c.Math.Between(0,n.length-1)]:null}const i=s(e.filter(n=>n.category==="WEAPON_UPGRADE"))??s(e.filter(n=>n.category==="WEAPON_NEW"))??s(e),a=s(e.filter(n=>n.category==="PASSIVE_UPGRADE"))??s(e.filter(n=>n.category==="PASSIVE_NEW"))??s(e.filter(n=>n.id!==i?.id)),r=s(e.filter(n=>n.id!==i?.id&&n.id!==a?.id));return[i,a,r].filter(n=>n)}applyWeaponUpgrade(t,e,s){t.weaponId&&(this.hero.weaponIds.includes(t.weaponId)||this.hero.weaponIds.push(t.weaponId),this.combat.setWeaponStats(t.weaponId,e),this.hooks.onShowMessage(s))}applyAreaUpgrade(){this.hero.areaMultiplier*=1.1,this.combat.refreshWeapons(),this.hooks.onShowMessage("Area increased by 10%!")}applyDamageUpgrade(){this.hero.damageMultiplier*=1.1,this.combat.refreshWeapons(),this.hooks.onShowMessage("Damage increased by 10%!")}}const ue=z*.3,Y={duration:100,r:120,g:200,b:255},X={duration:100,r:80,g:180,b:255},B=T*3;class ge{scene;xpManager;hooks;healPacks=[];magnetPickups=[];constructor(t,e,s){this.scene=t,this.xpManager=e,this.hooks=s}spawnHealPack(t){const e=c.Math.FloatBetween(t.left+B,t.right-B),s=c.Math.FloatBetween(t.top+B,t.bottom-B),i=P,a=this.scene.add.image(e,s,w.key,y.healPotion);a.setDisplaySize(i,i),a.setTint(15753280),a.setData("radius",i/2),this.healPacks.push(a)}spawnMagnetPickup(t){if(this.magnetPickups.some(r=>r.active))return;const e=c.Math.FloatBetween(t.left+B,t.right-B),s=c.Math.FloatBetween(t.top+B,t.bottom-B),i=P,a=this.scene.add.image(e,s,w.key,y.portalOpens);a.setDisplaySize(i,i),a.setTint(4367861),a.setData("radius",i/2),a.setDepth(.2),this.magnetPickups.push(a)}update(t){const e=this.hooks.getHero(),s=e.sprite,i=e.radius,a=s.x,r=s.y;this.healPacks=this.healPacks.filter(n=>{if(!n.active)return n.destroy(),!1;const h=n.getData("radius")??P/2;return c.Math.Distance.Between(n.x,n.y,a,r)<h+i?(this.collectHealPack(n),!1):this.isOutOfBounds(n.x,n.y,t)?(n.destroy(),!1):!0}),this.magnetPickups=this.magnetPickups.filter(n=>{if(!n.active)return n.destroy(),!1;const h=n.getData("radius")??P/2;return c.Math.Distance.Between(n.x,n.y,a,r)<h+i?(this.collectMagnetPickup(n),!1):this.isOutOfBounds(n.x,n.y,t)?(n.destroy(),!1):!0})}destroy(){this.healPacks.forEach(t=>t.destroy()),this.healPacks=[],this.magnetPickups.forEach(t=>t.destroy()),this.magnetPickups=[]}collectHealPack(t){const e=this.hooks.getHero();se(e,ue),this.scene.cameras.main.flash(X.duration,X.r,X.g,X.b,!1),t.destroy(),this.hooks.onHeroHealed()}collectMagnetPickup(t){this.xpManager.activateMagnet(),this.scene.cameras.main.flash(Y.duration,Y.r,Y.g,Y.b,!1),t.destroy(),this.hooks.onMagnetActivated()}isOutOfBounds(t,e,s){const i=N;return t<s.left-i||t>s.right+i||e<s.top-i||e>s.bottom+i}}class ot extends c.GameObjects.Container{static frames={sword:y.sword1,pistol:y.pistol1,bomb:y.bomb,aura:y.aura};static upgradeChains={aura:["aura","auraMk2","auraMk3","auraMk4","auraMk5"],pistol:["pistol","pistolMk2","pistolMk3","pistolMk4","pistolMk5"],bomb:["bomb","bombMk2","bombMk3"],sword:["sword","swordMk2","swordMk3","swordMk4","swordMk5"]};hero;constructor(t,e){super(t,16,30),this.hero=e,this.setDepth(2),this.setScrollFactor(0),t.add.existing(this)}refresh(){this.removeAll(!0),this.setPosition(16,30);const t=20;this.hero.weaponIds.forEach((e,s)=>{const i=ot.frames[e];if(i===void 0)return;const a=this.getWeaponLevel(e),r=new c.GameObjects.Container(this.scene,s*t*1.5,0),n=new c.GameObjects.Rectangle(this.scene,0,0,t,t,1710635,.65).setOrigin(0).setStrokeStyle(1,16777215,.2),u=a===1?16777215:a===2?16777045:a===3?5635925:a===4?5592575:16733525,m=new c.GameObjects.Sprite(this.scene,t/2,t/2,w.key,i).setOrigin(.5).setDisplaySize(t,t).setTint(u);r.add([n,m]),this.add(r)})}destroy(t){this.removeAll(!0),super.destroy(t)}getWeaponLevel(t){const e=ot.upgradeChains[t];if(!e)return 1;for(let s=e.length-1;s>=0;s-=1)if(this.hero.upgrades.includes(e[s]))return s+1;return 1}}class Wt{container;scene;constructor(t){this.scene=t}show(t,e,s,i){const a=t==="killed"?"Game Over":"Complete",r=t==="killed"?"#ff5252":"#69f0ae",{width:n,height:h}=this.scene.scale;this.clear();const l=this.scene.add.container(n/2,h/2).setScrollFactor(0).setDepth(6),p=this.scene.add.text(0,-96,a,{color:r,fontFamily:"monospace",fontSize:"36px",backgroundColor:"#1a1a25ee",padding:{x:18,y:10}}).setOrigin(.5),d=this.scene.add.text(0,-32,`Wave ${e} | Kills ${s}`,{color:"#f5f5f5",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#1a1a25cc",padding:{x:14,y:6}}).setOrigin(.5);l.add([p,d]);const g=this.createDamageTable(d.y+d.height/2+32);let u=d.y+d.height/2+72;g&&(l.add(g),u=g.y+(g.height??0)/2+32);const m=this.scene.add.text(0,u,"Exit",{color:"#ff8a80",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#303048dd",padding:{x:10,y:6}}).setOrigin(.5).setScrollFactor(0).setInteractive({useHandCursor:!0});m.on("pointerdown",()=>i()),l.add(m),this.container=l}clear(){this.container?.destroy(),this.container=void 0}createDamageTable(t){const e=Object.entries(_.weapon_damage??{});if(!e.length)return;e.sort((g,u)=>(u[1]??0)-(g[1]??0));const s=320,i=16,a=40,r=28,n=e.length,h=i*2+r+n*a,l=this.scene.add.container(0,t+h/2).setScrollFactor(0);l.setSize(s,h);const p=this.scene.add.rectangle(0,0,s,h,1118495,.92).setOrigin(.5).setStrokeStyle(1,16777215,.2);l.add(p);const d=this.scene.add.text(0,-h/2+i,"Damage dealt",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px"}).setOrigin(.5,0);return l.add(d),e.forEach(([g,u],m)=>{const E=Math.round(u??0),x=-h/2+i+r+m*a,v=x+a/2,H=this.scene.add.rectangle(0,v,s-i*2,a-6,16777215,.05).setOrigin(.5);l.add(H);const F=28,G=fe(this.scene,g);G.setPosition(-s/2+i,x+(a-F)/2),l.add(G);const Vt=this.scene.add.text(-s/2+i+F+12,v,E.toLocaleString(),{color:"#ffffff",fontFamily:"monospace",fontSize:"18px"}).setOrigin(0,.5);l.add(Vt)}),l}}const me={sword:y.sword1,pistol:y.pistol1,bomb:y.bomb,aura:y.aura};function fe(o,t){const e=o.add.container(0,0).setSize(20,20),s=new c.GameObjects.Rectangle(o,0,0,20,20,1710635,.65).setOrigin(0).setStrokeStyle(1,16777215,.2),i=me[t];if(i!==void 0){const a=new c.GameObjects.Sprite(o,10,10,w.key,i).setOrigin(.5).setDisplaySize(20,20).setTint(16777215);e.add([s,a])}else{const a=new c.GameObjects.Text(o,10,10,t.slice(0,1).toUpperCase(),{color:"#e0e0e0",fontFamily:"monospace",fontSize:"12px"}).setOrigin(.5);e.add([s,a])}return e}const xt=[{id:"baldYrev",name:"Bald Yrev",spriteFrame:y.miner,startingUpgradeId:"bomb",description:"Demolition expert that begins with bombs.",tint:16361509},{id:"holyShepard",name:"Holy Shepard",spriteFrame:y.king,startingUpgradeId:"aura",description:"Brave king radiating a protective aura.",tint:16772275},{id:"lawfulUmar",name:"Lawful Umar",spriteFrame:y.hero,startingUpgradeId:"pistol",description:"Disciplined ranger with a reliable pistol.",tint:8508666},{id:"vanPiercing",name:"Van Piercing",spriteFrame:y.swordsman,startingUpgradeId:"sword",description:"Blade virtuoso cleaving foes with a sword.",tint:16747109}],gt=xt[0];function ye(o){return xt.find(t=>t.id===o)??gt}const we="HordesHeroSelect",Ct="HordesMain";class xe{width;height=6;padding=1;bg;fill;hero;constructor(t,e){this.hero=e;const s=this.getOffsetY();this.width=e.sprite.displayWidth,this.bg=t.add.rectangle(e.sprite.x,e.sprite.y-s,this.width,this.height,0,.7).setOrigin(.5).setDepth(1),this.fill=t.add.rectangle(e.sprite.x-this.width/2+this.padding,this.bg.y,this.width-this.padding*2,this.height-this.padding*2,5025616).setOrigin(0,.5).setDepth(1.1),this.updateValue(e.hp,e.maxHp)}syncPosition(){const t=this.hero.sprite.x,e=this.hero.sprite.y+this.getOffsetY(),s=t-this.width/2+this.padding;this.bg.setPosition(t,e),this.fill.setPosition(s,e)}updateValue(t,e){const s=c.Math.Clamp(e===0?0:t/e,0,1),i=Math.max(0,this.width-this.padding*2);this.fill.displayWidth=i*s,s>.6?this.fill.setFillStyle(5025616):s>.3?this.fill.setFillStyle(16761095):this.fill.setFillStyle(16732754)}destroy(){this.bg.destroy(),this.fill.destroy()}getOffsetY(){return this.hero.sprite.displayHeight/2+4}}class Se{width;height=5;padding=1;bg;fill;hero;constructor(t,e){this.hero=e;const s=this.getOffsetY();this.width=e.sprite.displayWidth,this.bg=t.add.rectangle(e.sprite.x,e.sprite.y-s,this.width,this.height,0,.7).setOrigin(.5).setDepth(1),this.fill=t.add.rectangle(e.sprite.x-this.width/2+this.padding,this.bg.y,this.width-this.padding*2,this.height-this.padding*2,2134256).setOrigin(0,.5).setDepth(1.1),this.updateValue(0)}syncPosition(){const t=this.hero.sprite.x,e=this.hero.sprite.y+this.getOffsetY(),s=t-this.width/2+this.padding;this.bg.setPosition(t,e),this.fill.setPosition(s,e)}updateValue(t){const e=c.Math.Clamp(t,0,1),s=Math.max(0,this.width-this.padding*2);this.fill.displayWidth=s*e}destroy(){this.bg.destroy(),this.fill.destroy()}getOffsetY(){return this.hero.sprite.displayHeight/2+6}}class L extends c.Scene{static exitHandler;hero;inputController;enemies=[];background;worldBounds=Yt;heroHpBar;heroXpBar;infoText;weaponHud;kills=0;wave=0;combat;xpManager;enemyManager;waveManager;pickupManager;upgradeManager;pauseButton;pauseExitButton;isPaused=!1;totalXp=0;level=1;nextLevelXp=100;pendingLevelUps=0;currentLevelXpBase=0;supportTimersStarted=!1;pickupTimers=[];wavesOver=!1;isGameOver=!1;exitHandled=!1;gameOverHud;heroDefinition=gt;constructor(){super(Ct)}static registerExitHandler(t){L.exitHandler=t}init(t){this.heroDefinition=ye(t?.heroId)}preload(){this.textures.exists(w.key)||this.load.spritesheet(w.key,w.url,{frameWidth:w.frameWidth,frameHeight:w.frameHeight,spacing:w.spacing})}create(){const{width:t,height:e}=this.scale;if(this.isGameOver=!1,this.exitHandled=!1,this.cameras.main.setBackgroundColor("#101014"),this.time.timeScale=0,this.isPaused=!0,_.weapon_damage={},!this.textures.exists("hordes-grid")){const a=this.add.graphics();a.setVisible(!1),a.fillStyle(1118493,1),a.fillRect(0,0,96,96),a.lineStyle(2,1908012,.6),a.strokeRect(0,0,96,96),a.lineStyle(1,2041148,.5),a.beginPath(),a.moveTo(48,0),a.lineTo(48,96),a.moveTo(0,48),a.lineTo(96,48),a.strokePath(),a.generateTexture("hordes-grid",96,96),a.destroy()}this.background=this.add.tileSprite(t/2,e/2,t,e,"hordes-grid"),this.background.setOrigin(.5),this.background.setScrollFactor(0),this.background.setDepth(-2);const s=this.heroDefinition??gt;this.hero=Qt(this,{frame:s.spriteFrame,tint:s.tint}),this.heroDefinition=s,this.heroHpBar=new xe(this,this.hero),this.heroXpBar=new Se(this,this.hero),this.enemies=[],this.xpManager=new ce(this),this.pickupManager=new ge(this,this.xpManager,{getHero:()=>this.hero,onHeroHealed:()=>this.updateHud(),onMagnetActivated:()=>{this.showMagnetPickup(),this.updateHud()}}),this.enemyManager=new le(this,this.enemies),this.waveManager=new de(this,this.enemyManager,{getHero:()=>this.hero,onWaveAdvanced:a=>{this.wave=a,this.updateHud()}}),this.ensureEnemyWalkAnimation(),this.kills=0,this.wave=0,this.totalXp=0,this.level=1,this.nextLevelXp=this.getNextLevelXp(this.level),this.pendingLevelUps=0,this.currentLevelXpBase=0,this.inputController=ne(this),this.combat=new ae(this,{hero:this.hero,getEnemies:()=>this.enemies,onEnemyKilled:(a,r)=>{this.kills+=1,this.xpManager.spawn(a.x,a.y,r.xp)}}),this.events.once(c.Scenes.Events.SHUTDOWN,()=>{this.combat.destroy(),this.inputController.destroy(),this.xpManager.destroyAll(),this.upgradeManager.destroy(),this.heroHpBar.destroy(),this.heroXpBar.destroy(),this.pickupManager.destroy(),this.waveManager.destroy(),this.clearSupportTimers(),this.weaponHud?.destroy(!0)});const i=this.cameras.main;i.setBounds(-this.worldBounds,-this.worldBounds,this.worldBounds*2,this.worldBounds*2),i.startFollow(this.hero.sprite,!0,1,1),i.centerOn(0,0),this.infoText=this.add.text(16,16,"Wave 0",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px"}).setDepth(2),this.infoText.setScrollFactor(0),this.weaponHud=new ot(this,this.hero),this.updateHud(),this.upgradeManager=new pe(this,this.hero,this.combat,{onMenuOpened:()=>this.pauseForUpgrade(),onMenuClosed:()=>this.onUpgradeMenuClosed(),onUpgradeApplied:()=>this.updateHud(),onShowMessage:a=>this.showWeaponUpgrade(a)}),this.upgradeManager.applyUpgrade(s.startingUpgradeId),this.pauseButton=this.add.text(t-16,16,"Pause",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#30304888",padding:{x:8,y:4}}).setOrigin(1,0).setDepth(2).setScrollFactor(0).setInteractive({useHandCursor:!0}),this.pauseButton.on("pointerdown",()=>this.togglePause()),this.pauseExitButton=this.add.text(t-16,this.pauseButton.y+this.pauseButton.displayHeight+12,"Exit",{color:"#ff8a80",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#30304888",padding:{x:8,y:4}}).setOrigin(1,0).setDepth(2).setScrollFactor(0).setInteractive({useHandCursor:!0}),this.pauseExitButton.on("pointerdown",()=>this.handleExit()),this.hidePauseHud(),this.hero.weaponIds.length===0&&(this.pendingLevelUps=Math.max(this.pendingLevelUps,1),this.tryOpenUpgradeMenu()),this.maybeStartWaves(),this.game.events.on("wavesOver",()=>this.wavesOver=!0),this.gameOverHud||(this.gameOverHud=new Wt(this),this.gameOverHud.clear())}update(t,e){const s=e/1e3;if(this.isPaused)return;const i=this.inputController.getDirection();te(this.hero,i,V,s);const a=this.cameras.main;this.background.tilePositionX=a.scrollX,this.background.tilePositionY=a.scrollY,this.heroHpBar.syncPosition(),this.heroXpBar.syncPosition();const r=this.cameras.main.worldView;this.enemies=this.enemyManager.update(this.hero,s,r,(n,h)=>{this.handleHeroHit(n,h)}),this.enemies.length===0&&this.wavesOver&&this.showGameOverHud("complete"),this.combat.update(s,r),this.xpManager.update(this.hero.sprite.x,this.hero.sprite.y,r,n=>this.awardXp(n)),this.pickupManager.update(r),this.enemyManager.resolveOverlaps()}maybeStartWaves(){this.waveManager.start(),this.startSupportTimers()}startSupportTimers(){if(this.supportTimersStarted)return;this.supportTimersStarted=!0;const t=this.time.addEvent({delay:1e4,callback:()=>this.pickupManager.spawnHealPack(this.cameras.main.worldView),loop:!0,startAt:4e3}),e=this.time.addEvent({delay:6e4,callback:()=>this.pickupManager.spawnMagnetPickup(this.cameras.main.worldView),loop:!0,startAt:0});this.pickupTimers.push(t,e)}clearSupportTimers(){this.pickupTimers.forEach(t=>t.remove()),this.pickupTimers=[],this.supportTimersStarted=!1}handleHeroHit(t,e){if(this.hero.hp<=0)return;const s=this.time.now,i=t.getData("lastHit");if(i&&s-i<1e3)return;t.setData("lastHit",s);const a=e.damage,r=ee(this.hero,a);this.cameras.main.flash(120,255,64,64,!1),this.updateHud(),r<=0&&(this.cameras.main.shake(250,.02),this.time.delayedCall(260,()=>this.showGameOverHud("killed")))}awardXp(t){if(t>0){for(this.totalXp+=t;this.totalXp>=this.nextLevelXp;){const e=this.nextLevelXp;this.level+=1,this.pendingLevelUps+=1,this.showLevelUp(),this.currentLevelXpBase=e,this.nextLevelXp+=this.getNextLevelXp(this.level)}this.tryOpenUpgradeMenu()}this.updateHud()}tryOpenUpgradeMenu(){if(this.pendingLevelUps<=0||this.upgradeManager.isActive())return;if(!this.upgradeManager.openMenu()){this.pendingLevelUps=0;return}this.pendingLevelUps-=1}handleExit(){if(this.exitHandled)return;this.exitHandled=!0,this.pauseExitButton?.disableInteractive(),this.gameOverHud?.clear();const t=L.exitHandler;t&&t({kills:this.kills,waves:this.wave+1})}pauseForUpgrade(){this.isPaused=!0,this.time.timeScale=0,this.pauseButton&&(this.pauseButton.disableInteractive(),this.pauseButton.setText("Upgrade")),this.hidePauseHud()}resumeFromUpgrade(){this.isPaused=!1,this.time.timeScale=1,this.pauseButton&&(this.pauseButton.setText("Pause"),this.pauseButton.setInteractive({useHandCursor:!0})),this.hidePauseHud()}onUpgradeMenuClosed(){this.resumeFromUpgrade(),this.pendingLevelUps>0&&this.tryOpenUpgradeMenu()}showLevelUp(){const t=this.add.text(this.scale.width/2,96,`Level ${this.level}!`,{color:"#ffe082",fontFamily:"monospace",fontSize:"24px",backgroundColor:"#1a1a25bb",padding:{x:12,y:6}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:t,alpha:0,y:t.y-32,duration:900,ease:"Sine.easeOut",onComplete:()=>t.destroy()}),this.cameras.main.flash(160,140,220,80,!1)}showWeaponUpgrade(t){const e=this.add.text(this.scale.width/2,140,t,{color:"#ffab40",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#222234dd",padding:{x:10,y:4}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:e,alpha:0,y:e.y-28,duration:900,ease:"Sine.easeOut",onComplete:()=>e.destroy()})}showMagnetPickup(){const t=this.add.text(this.scale.width/2,180,"Magnet activated!",{color:"#8c9eff",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#1f1f32dd",padding:{x:10,y:4}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:t,alpha:0,y:t.y-24,duration:900,ease:"Sine.easeOut",onComplete:()=>t.destroy()})}showGameOverHud(t){$t(),!this.isGameOver&&(this.isGameOver=!0,this.isPaused=!0,this.time.timeScale=0,this.pauseButton&&(this.pauseButton.disableInteractive(),this.pauseButton.setVisible(!1)),this.pauseExitButton&&(this.pauseExitButton.setVisible(!1),this.pauseExitButton.disableInteractive()),this.gameOverHud||(this.gameOverHud=new Wt(this)),this.gameOverHud.show(t,this.wave+1,this.kills,()=>this.handleExit()))}showPauseHud(){!this.pauseExitButton||this.isGameOver||(this.pauseExitButton.setVisible(!0),this.pauseExitButton.setInteractive({useHandCursor:!0}))}hidePauseHud(){!this.pauseExitButton||this.isGameOver||(this.pauseExitButton.setVisible(!1),this.pauseExitButton.disableInteractive())}getNextLevelXp(t){return Math.ceil(Xt*Math.pow(Kt,t-1))}togglePause(){this.upgradeManager.isActive()||this.isGameOver||(this.isPaused=!this.isPaused,this.pauseButton.setText(this.isPaused?"Resume":"Pause"),this.time.timeScale=this.isPaused?0:1,this.isPaused?this.showPauseHud():this.hidePauseHud())}updateHud(){this.updateInfoText(),this.weaponHud.refresh(),this.heroHpBar.updateValue(this.hero.hp,this.hero.maxHp);const t=this.nextLevelXp-this.currentLevelXpBase,e=this.totalXp-this.currentLevelXpBase,s=t>0?e/t:0;this.heroXpBar.updateValue(s)}updateInfoText(){this.infoText.setText(`Wave ${this.wave+1} | LVL ${this.level}
Kills ${this.kills}`)}ensureEnemyWalkAnimation(){if(!this.textures.exists(w.key)||this.anims.exists("enemy-walk"))return;const t=[y.mobWalk1,y.mobWalk2].map(e=>({key:w.key,frame:e}));this.anims.create({key:"enemy-walk",frames:t,frameRate:6,repeat:-1})}}const C=200,W=260,be=6;class Me extends c.Scene{hasChosen=!1;heroListContainer;heroListBounds={minY:0,maxY:0};heroViewportTop=0;heroViewportHeight=0;isDraggingHeroList=!1;dragStartPointerY=0;dragStartListY=0;scrollPointerId=null;heroSelectionLocked=!1;constructor(){super(we)}preload(){this.textures.exists(w.key)||this.load.spritesheet(w.key,w.url,{frameWidth:w.frameWidth,frameHeight:w.frameHeight,spacing:w.spacing})}create(){this.cameras.main.setBackgroundColor("#101014");const{width:t,height:e}=this.scale;this.add.text(t/2,90,"Choose your hero",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"30px"}).setOrigin(.5),this.add.text(t/2,130,"Each hero starts the battle with their own weapon.",{color:"#b0bec5",fontFamily:"monospace",fontSize:"18px"}).setOrigin(.5),this.heroViewportTop=190,this.heroViewportHeight=e-this.heroViewportTop-40;const s=Math.min(t-40,C*2+120),i=this.add.rectangle(t/2,this.heroViewportTop+this.heroViewportHeight/2,s,this.heroViewportHeight,0,0).setVisible(!1);this.heroListContainer=this.add.container(t/2,0),this.heroListContainer.setMask(i.createGeometryMask());const a=2,r=C/2+5,n=W+5;let h=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;xt.forEach((g,u)=>{const m=u%a,E=Math.floor(u/a),x=this.createHeroCard(g),v=m===0?-r:r,H=this.heroViewportTop+W/2+E*n;x.setPosition(v,H),this.heroListContainer.add(x),h=Math.min(h,H-W/2),l=Math.max(l,H+W/2)}),h===Number.POSITIVE_INFINITY&&(h=this.heroViewportTop,l=this.heroViewportTop);const p=this.heroViewportTop+this.heroViewportHeight,d=Math.min(p-l,0);this.heroListBounds={minY:d,maxY:0},this.heroListContainer.setY(0),this.setupHeroListInput()}createHeroCard(t){const e=this.add.container(0,0);e.setSize(C,W);const s=this.add.rectangle(0,0,C,W,1776427,.92).setStrokeStyle(2,16777215,.15).setOrigin(.5),i=this.add.sprite(0,-W/2+70,w.key,t.spriteFrame).setDisplaySize(56,56).setOrigin(.5).setTint(t.tint??16777215),a=this.add.text(0,i.y+48,t.name,{color:"#ffe082",fontFamily:"monospace",fontSize:"18px"}).setOrigin(.5),r=this.add.text(0,a.y+28,`Weapon: ${Ee(t.startingUpgradeId)}`,{color:"#8c9eff",fontFamily:"monospace",fontSize:"16px"}).setOrigin(.5),n=this.add.text(0,r.y+26,t.description,{color:"#cfd8dc",fontFamily:"monospace",fontSize:"14px",wordWrap:{width:C-40}}).setOrigin(.5,0);return e.add([s,i,a,r,n]),e.setInteractive({hitArea:new c.Geom.Rectangle(0,0,C,W),hitAreaCallback:c.Geom.Rectangle.Contains,useHandCursor:!0}),e.on("pointerover",()=>s.setStrokeStyle(2,16771899,.9)),e.on("pointerout",()=>s.setStrokeStyle(2,16777215,.15)),e.on("pointerup",()=>{this.heroSelectionLocked||this.handleHeroPick(t.id)}),e}setupHeroListInput(){this.input.on("wheel",(t,e,s,i)=>this.adjustHeroListPosition(-i)),this.input.on("pointerdown",t=>{this.isPointerInHeroViewport(t)&&(this.scrollPointerId=t.id,this.isDraggingHeroList=!1,this.heroSelectionLocked=!1,this.dragStartPointerY=t.y,this.dragStartListY=this.heroListContainer?.y??0)}),this.input.on("pointermove",t=>{if(!t.isDown||t.id!==this.scrollPointerId)return;const e=t.y-this.dragStartPointerY;!this.isDraggingHeroList&&Math.abs(e)>=be&&(this.isDraggingHeroList=!0,this.heroSelectionLocked=!0),this.isDraggingHeroList&&this.setHeroListPosition(this.dragStartListY+e)}),this.input.on("pointerup",t=>this.endHeroListDrag(t)),this.input.on("pointerupoutside",t=>this.endHeroListDrag(t))}adjustHeroListPosition(t){!this.heroListContainer||t===0||this.setHeroListPosition(this.heroListContainer.y+t)}setHeroListPosition(t){if(!this.heroListContainer)return;const{minY:e,maxY:s}=this.heroListBounds,i=c.Math.Clamp(t,e,s);this.heroListContainer.setY(i)}isPointerInHeroViewport(t){const e=this.heroViewportTop,s=e+this.heroViewportHeight;return t.y>=e&&t.y<=s}endHeroListDrag(t){if(t.id!==this.scrollPointerId)return;const e=this.isDraggingHeroList;this.isDraggingHeroList=!1,this.scrollPointerId=null,e&&this.time.delayedCall(0,()=>{this.heroSelectionLocked=!1})}handleHeroPick(t){this.hasChosen||(this.hasChosen=!0,this.cameras.main.fadeOut(200,0,0,0,(e,s)=>{s===1&&this.scene.start(Ct,{heroId:t})}))}}function Ee(o){switch(o){case"bomb":return"Bombs";case"aura":return"Aura";case"pistol":return"Pistol";case"sword":return"Sword";default:return o}}const Ut=600,Ft=800,ke={type:c.AUTO,width:Ut,height:Ft,backgroundColor:"#101014",scene:[Me,L],fps:{target:60},scale:{mode:c.Scale.ScaleModes.FIT,autoCenter:c.Scale.Center.CENTER_BOTH}},Gt="hordesHighScores",zt=5,ve=()=>{try{const o=window.localStorage.getItem(Gt);if(!o)return[];const t=JSON.parse(o);return Array.isArray(t)?t.sort((e,s)=>s.kills!==e.kills?s.kills-e.kills:s.waves!==e.waves?s.waves-e.waves:s.timestamp-e.timestamp).slice(0,zt):[]}catch(o){return console.warn("Failed to read Hordes high scores",o),[]}},De=o=>{try{window.localStorage.setItem(Gt,JSON.stringify(o))}catch(t){console.warn("Failed to save Hordes high scores",t)}},Ae=(o,t)=>{const e=[...o,{...t,timestamp:Date.now()}];return e.sort((s,i)=>i.kills!==s.kills?i.kills-s.kills:i.waves!==s.waves?i.waves-s.waves:i.timestamp-s.timestamp),e.slice(0,zt)},Be=()=>{const o=A.useRef(null),t=A.useRef(null),[e,s]=A.useState(!1),[i,a]=A.useState(null),[r,n]=A.useState([]);A.useEffect(()=>{n(ve())},[]);const h=A.useCallback(p=>{a(p),s(!1),n(d=>{const g=Ae(d,p);return De(g),g})},[]);A.useEffect(()=>{if(!e){L.registerExitHandler(void 0),t.current&&(t.current.destroy(!0),t.current=null);return}const p=o.current;if(!p)return;L.registerExitHandler(h);const d=Ut*Ft,g=p.clientWidth/p.clientHeight,u=Math.sqrt(d)*Math.sqrt(g),m=Math.sqrt(d)/Math.sqrt(g);console.log("RATIO",g,u,"X",m,";",p.clientWidth,"X",p.clientHeight);const E=new c.Game({parent:p,...ke,width:u,height:m});t.current=E;const x=()=>{},v=new ResizeObserver(x);return v.observe(p),()=>{L.registerExitHandler(void 0),v?.disconnect(),E.destroy(!0),t.current=null}},[h,e]);const l=A.useCallback(()=>{a(null),s(!0)},[]);return e?f.jsx("div",{className:"h-screen w-screen overflow-hidden bg-[#101014] text-gray-100",children:f.jsx("div",{ref:o,className:"h-full w-full"})}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-start bg-gray-900 px-6 py-6 pb-28 text-gray-100",children:[f.jsx("h1",{className:"mb-4 text-3xl font-semibold",children:"Hordes"}),f.jsx("div",{className:"flex w-full max-w-[1100px] flex-col gap-6 lg:flex-row",children:f.jsxs("div",{className:"flex-1 rounded-lg border border-[#252545] bg-[#161626] p-5",children:[f.jsx("h2",{className:"mb-3 text-xl font-semibold",children:"High Scores"}),r.length===0?f.jsx("p",{className:"text-sm opacity-70",children:"No runs recorded yet. Be the first!"}):f.jsxs("table",{className:"w-full border-collapse text-sm",children:[f.jsx("thead",{children:f.jsxs("tr",{className:"border-b border-[#2c2c45] text-left",children:[f.jsx("th",{className:"px-1 py-1",children:"#"}),f.jsx("th",{className:"px-1 py-1",children:"Kills"}),f.jsx("th",{className:"px-1 py-1",children:"Waves"}),f.jsx("th",{className:"px-1 py-1",children:"Date"})]})}),f.jsxs("tbody",{children:[i&&f.jsxs("tr",{children:[f.jsx("td",{className:"px-1 py-1",children:"Last"}),f.jsx("td",{className:"px-1 py-1",children:i.kills}),f.jsx("td",{className:"px-1 py-1",children:i.waves})]}),r.map((p,d)=>f.jsxs("tr",{className:"border-b border-white/5",children:[f.jsx("td",{className:"px-1 py-2",children:d+1}),f.jsx("td",{className:"px-1 py-2",children:p.kills}),f.jsx("td",{className:"px-1 py-2",children:p.waves}),f.jsx("td",{className:"px-1 py-2",children:new Date(p.timestamp).toLocaleDateString()})]},`${p.timestamp}-${d}`))]})]})]})}),f.jsx(jt,{to:"/",className:`mt-6 inline-flex items-center justify-center rounded-md border border-slate-600
          bg-slate-800 px-4 py-2 text-sm font-medium text-slate-100 transition hover:bg-slate-700`,children:"Back to main page"})]}),f.jsx("button",{onClick:l,className:`fixed bottom-6 left-1/2 z-50 w-[calc(100%-3rem)] max-w-md -translate-x-1/2 transform rounded-md
        bg-green-600 px-4 py-3 text-base font-semibold text-white shadow-lg transition hover:bg-green-500`,children:"Play"})]})};export{Be as default};
