import{r as k,j as f,L as Bt}from"./index-DZ94uQhg.js";import{O as y,a as M,P as l}from"./sprite-DTl04m-3.js";const It=2e4,Z=150,H=14,F=100,N=5,at=Z*.6,U=H,ot=5,Q=F*.05,x=20,tt=2,E=H*2,T=260,Tt=x*tt,_t=1.3,Mt=U*2;function Wt(r){const t=r.add.sprite(0,0,y.key,M.hero);t.setOrigin(.5),t.setDisplaySize(H*2,H*2),t.setTint(5025616),t.setDepth(.2),t.setData("radius",H);const e=r.add.circle(t.x,t.y,Mt,16771899,.1);return e.setDepth(-1),e.setVisible(!1),{sprite:t,aura:e,radius:H,maxHp:F,hp:F,hasAura:!1,upgrades:[],weaponIds:[],direction:new l.Math.Vector2(0,0),areaMultiplier:1,damageMultiplier:1}}function Ht(r,t,e,i){r.sprite.x+=t.x*e*i,r.sprite.y+=t.y*e*i,r.aura.setPosition(r.sprite.x,r.sprite.y),t.lengthSq()>1e-4&&r.direction.copy(t)}function Ut(r,t){return r.hp=Math.max(0,r.hp-t),r.hp}function Nt(r,t){return r.hp=Math.min(r.maxHp,r.hp+t),r.hp}function A(r){return{damage:Math.ceil(r.damage??N),cooldown:Math.ceil((r.cooldown??2)*10)/10,area:Math.ceil(r.area??0),pierce:Math.ceil(r.pierce??0),sectorAngle:Math.ceil(r.sectorAngle??120)}}const nt=A({damage:N,cooldown:.5,pierce:1,area:6}),et=r=>A({...r,damage:r.damage*1.1,cooldown:r.cooldown*.9,pierce:r.pierce+1}),L=et(nt),G=et(L),z=et(G),vt=et(z),rt=A({damage:N,cooldown:1,area:Mt}),st=r=>A({...r,damage:r.damage*1.1,cooldown:r.cooldown*.9,area:r.area*1.2}),V=st(rt),j=st(V),K=st(j),bt=st(K),ht=A({cooldown:5,damage:N*4,area:100}),St=r=>A({...r,damage:r.damage*1.3,cooldown:r.cooldown*.7,area:r.area*1.2}),X=St(ht),kt=St(X),ct=A({cooldown:2,damage:N*2,area:50,sectorAngle:120}),it=r=>A({...r,damage:r.damage*1.1,cooldown:r.cooldown*.9,area:r.area+10,sectorAngle:r.sectorAngle+10}),q=it(ct),$=it(q),Y=it($),Et=it(Y),pt=[{id:"aura",label:"Unlock Aura",description:"Activate a damaging circle around you.",category:"WEAPON_NEW",weaponId:"aura",level:1},{id:"auraMk2",label:"Aura Mk II",description:w(rt,V),requires:["aura"],category:"WEAPON_UPGRADE",weaponId:"aura",level:2},{id:"auraMk3",label:"Aura Mk III",description:w(V,j),requires:["auraMk2"],category:"WEAPON_UPGRADE",weaponId:"aura",level:3},{id:"auraMk4",label:"Aura Mk IV",description:w(j,K),requires:["auraMk3"],category:"WEAPON_UPGRADE",weaponId:"aura",level:4},{id:"auraMk5",label:"Aura Mk V",description:w(K,bt),requires:["auraMk4"],category:"WEAPON_UPGRADE",weaponId:"aura",level:5},{id:"pistol",label:"Equip Pistol",description:"Basic ranged damage with moderate fire rate.",category:"WEAPON_NEW",weaponId:"pistol",level:1},{id:"pistolMk2",label:"Pistol Mk II",description:w(nt,L),requires:["pistol"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:2},{id:"pistolMk3",label:"Pistol Mk III",description:w(L,G),requires:["pistolMk2"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:3},{id:"pistolMk4",label:"Pistol Mk IV",description:w(G,z),requires:["pistolMk3"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:4},{id:"pistolMk5",label:"Pistol Mk V",description:w(z,vt),requires:["pistolMk4"],category:"WEAPON_UPGRADE",weaponId:"pistol",level:5},{id:"bomb",label:"Deploy Bombs",description:"Drop timed explosives dealing area damage.",category:"WEAPON_NEW",weaponId:"bomb",level:1},{id:"bombMk2",label:"Bombs Mk II",description:w(ht,X),requires:["bomb"],category:"WEAPON_UPGRADE",weaponId:"bomb",level:2},{id:"bombMk3",label:"Bombs Mk III",description:w(X,kt),requires:["bombMk2"],category:"WEAPON_UPGRADE",weaponId:"bomb",level:3},{id:"sword",label:"Equip Sword",description:"Unlock a melee sword slash in your movement direction.",category:"WEAPON_NEW",weaponId:"sword",level:1},{id:"swordMk2",label:"Sword Mk II",description:w(ct,q),requires:["sword"],category:"WEAPON_UPGRADE",weaponId:"sword",level:2},{id:"swordMk3",label:"Sword Mk III",description:w(q,$),requires:["swordMk2"],category:"WEAPON_UPGRADE",weaponId:"sword",level:3},{id:"swordMk4",label:"Sword Mk IV",description:w($,Y),requires:["swordMk3"],category:"WEAPON_UPGRADE",weaponId:"sword",level:4},{id:"swordMk5",label:"Sword Mk V",description:w(Y,Et),requires:["swordMk4"],category:"WEAPON_UPGRADE",weaponId:"sword",level:5},{id:"area1",label:"Area +10%",description:"Increase area of effect by 10%",category:"PASSIVE_NEW",level:1},{id:"damage1",label:"Damage +10%",description:"Increase all weapon damage by 10%.",category:"PASSIVE_NEW",level:1}];function w(r,t){return[r.damage!==t.damage&&`DMG ${r.damage}→${t.damage}`,r.cooldown!==t.cooldown&&`Cooldown ${r.cooldown}→${t.cooldown}`,r.area!==t.area&&`Area ${r.area}→${t.area}`,r.pierce!==t.pierce&&`Pierce ${r.pierce}→${t.pierce}`,r.sectorAngle!==t.sectorAngle&&`Angle ${r.sectorAngle}→${t.sectorAngle}`].filter(Boolean).reduce((e,i)=>i?`${e} ${i}`:e,"")}class Rt{id=()=>"sword";swordElapsed=0;activeSwordSwing=null;scene;context;damageEnemy;stats;constructor(t,e,i,s){this.scene=t,this.context=e,this.stats=i,this.damageEnemy=s}update(t,e,i){this.activeSwordSwing&&this.updateActiveSwordSwing(t,e);const s=this.context.hero;if(s.hp<=0||(this.swordElapsed+=t,this.activeSwordSwing)||this.swordElapsed<this.stats.cooldown)return;const a=s.direction;if(!a||a.lengthSq()<1e-4)return;this.swordElapsed=0;const n=s.sprite,o=a.clone().normalize(),h=l.Math.RadToDeg(Math.atan2(o.y,o.x)),u=this.stats.sectorAngle/2,c=this.scene.add.graphics({x:n.x,y:n.y}),d=()=>{c.setPosition(n.x,n.y)};let g=!1;const p=()=>{g||(g=!0,this.scene.events.off(l.Scenes.Events.POST_UPDATE,d),this.scene.events.off(l.Scenes.Events.SHUTDOWN,p),c.destroy(),this.activeSwordSwing?.gfx===c&&(this.activeSwordSwing=null))};d(),this.scene.events.on(l.Scenes.Events.POST_UPDATE,d),this.scene.events.once(l.Scenes.Events.SHUTDOWN,p),c.setDepth(-.3),c.fillStyle(16766287,.35),c.beginPath(),c.slice(0,0,this.stats.area,l.Math.DegToRad(h-u),l.Math.DegToRad(h+u),!1),c.fillPath(),this.scene.tweens.add({targets:c,alpha:0,scale:1.05,duration:500,onComplete:p}),this.activeSwordSwing={gfx:c,angleDeg:h,halfArc:u,radius:this.stats.area,damage:this.stats.damage,remaining:.5,hitEnemies:new Set,cleanup:p},this.updateActiveSwordSwing(0,e)}reset(){this.swordElapsed=0,this.activeSwordSwing&&(this.activeSwordSwing.cleanup(),this.activeSwordSwing=null)}updateActiveSwordSwing(t,e){const i=this.activeSwordSwing;if(!i)return;if(i.remaining-=t,i.remaining<=0){i.cleanup(),this.activeSwordSwing=null;return}const a=this.context.hero.sprite;for(const n of e){if(i.hitEnemies.has(n))continue;const o=n.getData("mob");if(!n.active||!o)continue;const h=n.x-a.x,u=n.y-a.y;if(Math.hypot(h,u)>i.radius+o.size/2)continue;const d=l.Math.RadToDeg(Math.atan2(u,h)),g=l.Math.Angle.ShortestBetween(i.angleDeg,d);Math.abs(g)>i.halfArc||(i.hitEnemies.add(n),this.damageEnemy(n,i.damage,o))}}}class Ct{id=()=>"bomb";bombElapsed=0;bombs=[];scene;context;stats;damageEnemy;constructor(t,e,i,s){this.scene=t,this.context=e,this.stats=i,this.damageEnemy=s}update(t,e,i){for(this.bombElapsed+=t;this.bombElapsed>=this.stats.cooldown;)this.bombElapsed-=this.stats.cooldown,this.spawnBomb(this.stats);const s=this.scene.time.now;this.bombs=this.bombs.filter(a=>{if(!a.sprite.active)return a.sprite.destroy(),!1;const{detonateAt:n}=a,o=n-s,h=gt;if(o<=0)return this.detonateBomb(a,e),!1;const u=1-o/h;return a.sprite.setAlpha(.6+Math.sin(u*Math.PI*4)*.2),!0})}spawnBomb(t){const{sprite:e}=this.context.hero,i=this.scene.add.image(e.x,e.y,y.key,M.bomb);i.setDepth(-.5),i.setDisplaySize(E,E),i.setTint(16740419),i.setAlpha(.9);const s=this.scene.time.now+gt;this.bombs.push({sprite:i,detonateAt:s,weapon:t})}detonateBomb(t,e){const{sprite:i,weapon:s}=t,a=this.scene.add.circle(i.x,i.y,s.area,16755520,.35);a.setDepth(-.4),this.scene.tweens.add({targets:a,alpha:0,scale:1.4,duration:320,onComplete:()=>a.destroy()});const n=s.area,o=s.damage;for(const h of e){const u=h.getData("mob");if(!h.active||!u)continue;l.Math.Distance.Between(i.x,i.y,h.x,h.y)<=n+u.size/2&&this.damageEnemy(h,o,u)}i.destroy()}reset(){this.bombElapsed=0,this.bombs.forEach(t=>t.sprite.destroy()),this.bombs=[]}}const gt=2e3;class Ft{id=()=>"aura";scene;context;stats;damageEnemy;constructor(t,e,i,s){this.scene=t,this.context=e,this.stats=i,this.damageEnemy=s}update(t,e,i){e.forEach(s=>{const a=s.getData("mob");if(!s.active||!a)return!1;const n=this.context.hero.sprite.x-s.x,o=this.context.hero.sprite.y-s.y,h=Math.hypot(n,o)||.001;this.applyAuraDamage(s,h,a)})}applyAuraDamage(t,e,i){if(e>this.stats.area+i.size/2)return!1;const s=this.scene.time.now,a=t.getData("lastAuraTick"),n=this.stats.cooldown*1e3;if(a&&s-a<n)return!1;t.setData("lastAuraTick",s),this.damageEnemy(t,this.stats.damage,i);const o=this.context.hero.sprite,h=t.x-o.x,u=t.y-o.y,c=Math.hypot(h,u)||1,d=t.getData("auraKnockback")??40,g=Math.max(d/2,5);t.setData("auraKnockback",g),t.x+=h/c*d,t.y+=u/c*d;const p=t.getData("hpText");p?.active&&p.setPosition(t.x,t.y-i.size/2-8)}reset(){}}class Lt{id=()=>"pistol";scene;context;stats;damageEnemy;bullets=[];shootElapsed=0;constructor(t,e,i,s){this.scene=t,this.context=e,this.stats=i,this.damageEnemy=s}update(t,e,i){this.bullets=this.bullets.filter(s=>{const a=s.sprite;if(!a.active)return!1;if(a.x+=s.vx*t,a.y+=s.vy*t,a.x<i.left-T||a.x>i.right+T||a.y<i.top-T||a.y>i.bottom+T)return a.destroy(),!1;for(const n of e){const o=n.getData("mob");if(!(!n.active||!o)&&!s.hitEnemies.has(n)&&l.Math.Distance.Between(a.x,a.y,n.x,n.y)<o.size/2+s.radius&&(s.hitEnemies.add(n),this.damageEnemy(n,this.stats.damage,o),a.x+=s.vx*t*.3,a.y+=s.vy*t*.3,s.piercesLeft-=1,s.piercesLeft<=0))return a.destroy(),!1}return!0}),this.context.hero.hp>0&&this.tickAutoFire(t)}tickAutoFire(t){if(!this.context.getEnemies().some(g=>g.active)||(this.shootElapsed+=t,this.shootElapsed<this.stats.cooldown))return;this.shootElapsed=0;const i=this.findNearestEnemy();if(!i)return;const{sprite:s}=this.context.hero,a=i.x-s.x,n=i.y-s.y,o=Math.hypot(a,n);if(!o)return;const h=this.stats.area,u=this.scene.add.circle(s.x,s.y,h,11184810),c=a/o*mt,d=n/o*mt;this.bullets.push({sprite:u,vx:c,vy:d,radius:h,piercesLeft:this.stats.pierce,hitEnemies:new Set})}findNearestEnemy(){const{sprite:t}=this.context.hero,e=this.context.getEnemies();let i,s=Number.POSITIVE_INFINITY;for(const a of e){if(!a.active)continue;const n=l.Math.Distance.Between(t.x,t.y,a.x,a.y);n<s&&(i=a,s=n)}return i}reset(){this.bullets.forEach(t=>t.sprite.destroy()),this.bullets=[],this.shootElapsed=0}}const mt=Z*3;class Gt{scene;context;weapons=[];originalStats={};constructor(t,e){this.scene=t,this.context=e}reset(){this.weapons.forEach(t=>t.reset())}update(t,e){const i=this.context.getEnemies();this.weapons.forEach(s=>s.update(t,i,e))}refreshWeapons(){this.setPistolWeapon(this.originalStats.pistol??null),this.setBombWeapon(this.originalStats.bomb??null),this.setSwordWeapon(this.originalStats.sword??null),this.setAuraWeapon(this.originalStats.aura??null)}damageEnemy(t,e,i){if(!t.active)return!1;const a=(t.getData("hp")??i.health)-e;t.setData("hp",a);const n=t.getData("hpText");return n?.active&&n.setText(`${Math.max(a,0)}`),a<=0?(this.context.onEnemyKilled(t,i),t.setActive(!1),t.destroy(),!0):!1}setPistolWeapon(t){if(!t){this.unsetWeapon("pistol");return}this.originalStats.pistol=t;const e=this.withModifiers(t);this.setWeapon(new Lt(this.scene,this.context,e,this.damageEnemy))}setAuraWeapon(t){if(!t){this.unsetWeapon("aura");return}this.originalStats.aura=t;const e=this.withModifiers(t);this.setWeapon(new Ft(this.scene,this.context,e,this.damageEnemy))}setBombWeapon(t){if(!t){this.unsetWeapon("bomb");return}this.originalStats.bomb=t;const e=this.withModifiers(t);this.setWeapon(new Ct(this.scene,this.context,e,this.damageEnemy))}setSwordWeapon(t){if(!t){this.unsetWeapon("sword");return}this.originalStats.sword=t;const e=this.withModifiers(t);this.setWeapon(new Rt(this.scene,this.context,e,this.damageEnemy))}setWeapon(t){const e=this.weapons.findIndex(i=>i.id()===t.id());e>=0?(this.weapons[e].reset(),this.weapons[e]=t):this.weapons.push(t),t.reset()}unsetWeapon(t){const e=this.weapons.findIndex(i=>i.id()===t);e>=0&&(this.weapons[e].reset(),this.weapons.splice(e,1),this.originalStats[t]=void 0)}withModifiers(t){const e=this.context.hero,i=e.areaMultiplier,s=e.damageMultiplier;return A({...t,area:t.area*i,damage:t.damage*s})}}const D=68,zt=4;function Vt(r){const t=r.input.keyboard.createCursorKeys(),e=new l.Math.Vector2,i=new l.Math.Vector2;let s,a,n;const o=46,h=20,u=()=>{s&&a||(s=r.add.circle(120,r.scale.height-120,o,16777215,.1),s.setStrokeStyle(2,16777215,.35),s.setScrollFactor(0),s.setDepth(5),s.setVisible(!1),a=r.add.circle(s.x,s.y,h,16777215,.35),a.setScrollFactor(0),a.setDepth(6),a.setVisible(!1))},c=()=>{n=void 0,e.set(0,0),s&&a&&(a.setPosition(s.x,s.y),s.setVisible(!1),a.setVisible(!1))},d=m=>{n===void 0&&m.primaryDown&&(u(),!(!s||!a)&&(n=m.id,s.setPosition(m.x,m.y),a.setPosition(m.x,m.y),s.setVisible(!0),a.setVisible(!0),e.set(0,0)))},g=m=>{if(n!==m.id||!s||!a)return;const v=m.x-s.x,b=m.y-s.y,O=Math.hypot(v,b);if(O<=D)a.setPosition(m.x,m.y),e.set(v/D,b/D);else{const lt=Math.atan2(b,v),dt=Math.cos(lt)*D,ut=Math.sin(lt)*D;a.setPosition(s.x+dt,s.y+ut),e.set(dt/D,ut/D)}O<zt&&e.set(0,0)},p=m=>{n===m.id&&c()};return r.input.on("pointerdown",d),r.input.on("pointermove",g),r.input.on("pointerup",p),r.input.on("pointerupoutside",p),{cursors:t,getDirection(){i.copy(e),t.left.isDown&&(i.x-=1),t.right.isDown&&(i.x+=1),t.up.isDown&&(i.y-=1),t.down.isDown&&(i.y+=1);const m=i.length();return m>1&&i.scale(1/m),i.clone()},destroy(){c(),r.input.off("pointerdown",d),r.input.off("pointermove",g),r.input.off("pointerup",p),r.input.off("pointerupoutside",p),s?.destroy(),a?.destroy(),s=void 0,a=void 0,n=void 0}}}const jt=E*4,Kt=E,ft=Z*1.5,xt=100,W=E*.5;class Xt{scene;crystals=[];constructor(t){this.scene=t}spawn(t,e,i){const s=Math.max(1,Math.round(i)),a=l.Math.FloatBetween(-6,6),n=l.Math.FloatBetween(-6,6),o=this.scene.add.polygon(t+a,e+n,[0,-W,W,0,0,W,-W,0],6600182,.7);o.setOrigin(.5),o.setDepth(-.2),o.setStrokeStyle(1.2,16777215,.5),o.setData("xp",s),o.setData("baseSize",W),o.setData("magnetized",!1),o.setData("magnetSpeed",ft),this.updateCrystalVisual(o),this.crystals.push(o)}update(t,e,i,s){const a=l.Math.Clamp(this.scene.game.loop.delta,8,48)/1e3;this.crystals=this.crystals.filter(n=>{if(!n.active)return n.destroy(),!1;n.getData("magnetized")||l.Math.Distance.Between(n.x,n.y,t,e)<=jt&&n.setData("magnetized",!0);const h=n.getData("magnetized");if(h){const c=n.getData("magnetSpeed")??ft,d=t-n.x,g=e-n.y,p=Math.hypot(d,g)||1e-4,m=c*a;n.x+=d/p*m,n.y+=g/p*m}const u=l.Math.Distance.Between(n.x,n.y,t,e);if(h&&u<=Kt){const c=Math.max(1,Math.round(n.getData("xp")??0));return n.destroy(),c>0&&s(c),!1}return!0}),this.mergeOutOfBounds(i,t,e)}destroyAll(){this.crystals.forEach(t=>t.destroy()),this.crystals=[]}activateMagnet(){this.crystals.forEach(t=>{t.active&&t.setData("magnetized",!0)})}mergeOutOfBounds(t,e,i){if(this.crystals.length<=xt)return;const s=T;let a=0;for(;this.crystals.length>xt&&a<20;){const n=this.crystals.filter(d=>d.x<t.left-s||d.x>t.right+s||d.y<t.top-s||d.y>t.bottom+s);if(n.length<2)break;n.sort((d,g)=>{const p=l.Math.Distance.Between(e,i,d.x,d.y);return l.Math.Distance.Between(e,i,g.x,g.y)-p});const o=n[0],h=n[1];if(!o.active||!h.active){[o,h].forEach(d=>{d.active||(d.destroy(),this.crystals=this.crystals.filter(g=>g!==d))}),a+=1;continue}const u=Math.max(0,Math.round(o.getData("xp")??0)),c=Math.max(0,Math.round(h.getData("xp")??0));o.setData("xp",u+c),o.setPosition((o.x+h.x)/2,(o.y+h.y)/2),this.updateCrystalVisual(o),h.destroy(),this.crystals=this.crystals.filter(d=>d!==h),a+=1}}updateCrystalVisual(t){const e=t.getData("xp")??0,i=t.getData("baseSize")??W,s=l.Math.Clamp(6+Math.sqrt(e)*1.1,6,28),a=s/i;t.setScale(a),t.setData("radius",s);const n=l.Math.Clamp(.45+e/180,.45,.9);t.setFillStyle(6600182,n),t.setStrokeStyle(1.2,16777215,.45+Math.min(.4,e/120))}}class qt{scene;enemies;spawnBuffer=U*6;constructor(t,e){this.scene=t,this.enemies=e}spawn(t,e,i){const s=e.size/2,{x:a,y:n}=this.findSpawnPosition(t,s),o=e.frame??M.mobWalk1,h=this.scene.add.sprite(a,n,y.key,o);return h.setOrigin(.5),h.setDisplaySize(e.size,e.size),h.setTint(i),h.setDepth(.1),h.setActive(!0),h.setData("mob",e),h.setData("hp",e.health),h.setData("lastHit",0),h.setData("lastAuraTick",0),h.setData("auraKnockback",40),h.setData("radius",s),!e.frame&&this.scene.anims.exists("enemy-walk")&&(h.play("enemy-walk"),h.anims.setProgress(Math.random())),this.enemies.push(h),this.attachHpLabel(h,e),h}attachHpLabel(t,e){S.create(this.scene,t,e)}resolveOverlaps(){for(let t=0;t<this.enemies.length;t+=1){const e=this.enemies[t];if(!e.active)continue;const i=e.getData("mob");if(!i)continue;const s=i.size/2;for(let a=t+1;a<this.enemies.length;a+=1){const n=this.enemies[a];if(!n.active)continue;const o=n.getData("mob");if(!o)continue;const h=o.size/2,u=n.x-e.x,c=n.y-e.y,d=Math.hypot(u,c),g=s+h+2;if(d===0){const p=l.Math.FloatBetween(0,Math.PI*2);e.x+=Math.cos(p),e.y+=Math.sin(p),n.x-=Math.cos(p),n.y-=Math.sin(p),S.update(e,i),S.update(n,o);continue}if(d<g){const p=(g-d)/2,m=u/d,v=c/d;e.x-=m*p,e.y-=v*p,n.x+=m*p,n.y+=v*p,S.update(e,i),S.update(n,o)}}}}update(t,e,i,s){return this.enemies=this.enemies.filter(a=>this.updateEnemyState(a,t,e,i,s)),this.enemies}updateEnemyState(t,e,i,s,a){const n=t.getData("mob");if(!t.active||!n)return!1;const o=this.moveEnemyTowardsHero(t,n,e,i);return S.update(t,n),o<e.radius+n.size/2&&a(t,n),this.shouldCullEnemy(t,n.size/2,s)?(t.destroy(),!1):t.active}moveEnemyTowardsHero(t,e,i,s){const a=i.sprite.x-t.x,n=i.sprite.y-t.y,o=Math.hypot(a,n)||.001,h=e.speed;return t.x+=a/o*h*s,t.y+=n/o*h*s,a!==0&&t.setFlipX(a<0),o}shouldCullEnemy(t,e,i){const s=T+e;return t.x<i.left-s||t.x>i.right+s||t.y<i.top-s||t.y>i.bottom+s}findSpawnPosition(t,e){const s=this.scene.cameras.main.worldView;let a={x:s.centerX,y:s.y};const n=12;for(let o=0;o<n;o+=1){let h=0,u=0;switch(t){case 0:h=s.centerX+l.Math.FloatBetween(-s.width/2,s.width/2),u=s.top-this.spawnBuffer;break;case 1:h=s.right+this.spawnBuffer,u=s.centerY+l.Math.FloatBetween(-s.height/2,s.height/2);break;case 2:h=s.centerX+l.Math.FloatBetween(-s.width/2,s.width/2),u=s.bottom+this.spawnBuffer;break;default:h=s.left-this.spawnBuffer,u=s.centerY+l.Math.FloatBetween(-s.height/2,s.height/2);break}if(h+=l.Math.FloatBetween(-e,e),u+=l.Math.FloatBetween(-e,e),a={x:h,y:u},this.isPositionClear(h,u,e))break}return a}isPositionClear(t,e,i){for(const a of this.enemies){if(!a.active)continue;const n=a.getData("mob");if(!n)continue;const o=n.size/2;if(l.Math.Distance.Between(t,e,a.x,a.y)<i+o+6)return!1}return!0}}class S{static DATA_KEY="hpText";static create(t,e,i){const s=t.add.text(e.x,e.y,`${i.health}`,{color:"#ffffff",fontFamily:"monospace",fontSize:"12px"}).setOrigin(.5).setDepth(1);e.setData(S.DATA_KEY,s),e.once("destroy",()=>s.destroy()),S.update(e,i)}static update(t,e){const i=S.get(t);i?.active&&i.setPosition(t.x,t.y-e.size/2-8)}static get(t){return t.getData(S.DATA_KEY)}}class $t{scene;enemyManager;hooks;wave=0;running=!1;waveTimer;constructor(t,e,i){this.scene=t,this.enemyManager=e,this.hooks=i}start(){this.running||(this.running=!0,this.spawnWave(),this.waveTimer=this.scene.time.addEvent({delay:5e3,callback:this.spawnWave,callbackScope:this,loop:!0,startAt:0}))}stop(){this.running&&(this.running=!1,this.waveTimer?.remove(),this.waveTimer=void 0,this.wave=0)}isRunning(){return this.running}destroy(){this.stop()}spawnWave=()=>{if(!this.hooks.getHero())return;if(this.wave+=1,yt.length<=this.wave){this.gameover();return}this.hooks.onWaveAdvanced(this.wave);const e=yt[this.wave],i=l.Math.Between(0,3);for(const s of e.mobs){const a=s.amount,n=s.stats;for(let o=0;o<a;o+=1){if(o<a*.1){this.spawnEnemy(i+1,n);continue}if(o<a*.2){this.spawnEnemy(i+2,n);continue}if(o<a*.5){this.spawnEnemy(i+3,n);continue}this.spawnEnemy(i,n)}}};spawnEnemy(t,e){t=t%4;const i=1+this.wave/20,s=e.damage/Q*i,a=Yt(.5+s/2,.4,.5+(1-s)/2);this.enemyManager.spawn(t,e,a)}gameover(){this.stop(),this.scene.game.events.emit("wavesOver")}}function Yt(r,t,e){const i=255*Math.min(Math.max(r,0),1),s=255*Math.min(Math.max(t,0),1),a=255*Math.min(Math.max(e,0),1);return i*65536&16711680|s*256&65280|a}const B={size:U*2,speed:at,health:ot,xp:tt,damage:Q},I={size:U*2.5,speed:at,health:ot*3,xp:tt*2,damage:Q*1.5,frame:M.enemy1},wt={size:U*3,speed:at,health:ot*5,xp:tt*4,damage:Q*2.5,frame:M.enemy2},yt=[...Jt(3,{mobs:[{stats:B,amount:x}]}),{mobs:[{stats:B,amount:x},{stats:I,amount:x/5}]},{mobs:[{stats:B,amount:x},{stats:I,amount:x/4}]},{mobs:[{stats:B,amount:x},{stats:I,amount:x/3}]},{mobs:[{stats:B,amount:x},{stats:I,amount:x/2}]},{mobs:[{stats:B,amount:x},{stats:I,amount:x}]},{mobs:[{stats:B,amount:x},{stats:I,amount:x},{stats:wt,amount:x/4}]},{mobs:[{stats:I,amount:x},{stats:wt,amount:x/2}]}];function Jt(r,t){const e=[];for(let i=0;i<r;i+=1)e.push(t);return e}class Zt{scene;hero;combat;hooks;overlay=[];active=!1;constructor(t,e,i,s){this.scene=t,this.hero=e,this.combat=i,this.hooks=s}isActive(){return this.active}openMenu(){if(this.active)return!0;const t=this.getAvailableUpgrades();if(!t.length)return!1;this.active=!0,this.hooks.onMenuOpened(),this.clearOverlay();const{width:e,height:i}=this.scene.scale,s=e/2,a=i/2,n=Math.min(e-80,420),o=84,h=t.length*o+140,u=this.scene.add.rectangle(s,a,e,i,0,.55).setScrollFactor(0).setDepth(10).setInteractive();this.overlay.push(u);const c=this.scene.add.rectangle(s,a,n,h,2302778,.96).setScrollFactor(0).setDepth(11).setStrokeStyle(2,16771899,.5);this.overlay.push(c);const g=this.scene.add.text(s,a-h/2+40,"Choose Upgrade",{color:"#ffe082",fontFamily:"monospace",fontSize:"22px"}).setOrigin(.5).setScrollFactor(0).setDepth(12);return this.overlay.push(g),t.forEach((p,m)=>{const v=a-h/2+88+m*o,b=this.scene.add.text(s,v,p.label,{color:"#f5f5f5",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#30304a",padding:{x:16,y:10}}).setOrigin(.5).setScrollFactor(0).setDepth(12).setInteractive({useHandCursor:!0});b.on("pointerover",()=>b.setStyle({backgroundColor:"#3d3d5c"})),b.on("pointerout",()=>b.setStyle({backgroundColor:"#30304a"})),b.on("pointerdown",()=>this.applyUpgrade(p.id)),this.overlay.push(b);const O=this.scene.add.text(s,v+28,p.description,{color:"#b0bec5",fontFamily:"monospace",fontSize:"16px"}).setOrigin(.5,0).setScrollFactor(0).setDepth(12);this.overlay.push(O)}),!0}destroy(){this.clearOverlay()}applyUpgrade(t){switch(this.hero.upgrades.includes(t)||this.hero.upgrades.push(t),t){case"aura":this.handleAuraUpgrade(rt,"Aura weapon activated!");break;case"auraMk2":this.handleAuraUpgrade(V,"Aura Mk II empowered!");break;case"auraMk3":this.handleAuraUpgrade(j,"Aura Mk III intensified!");break;case"auraMk4":this.handleAuraUpgrade(K,"Aura Mk IV radiates farther!");break;case"auraMk5":this.handleAuraUpgrade(bt,"Aura Mk V unleashed!");break;case"pistol":this.handlePistolUpgrade(nt,"Pistol ready!");break;case"pistolMk2":this.handlePistolUpgrade(L,"Pistol Mk II ready!");break;case"pistolMk3":this.handlePistolUpgrade(G,"Pistol Mk III ready!");break;case"pistolMk4":this.handlePistolUpgrade(z,"Pistol Mk IV ready!");break;case"pistolMk5":this.handlePistolUpgrade(vt,"Pistol Mk V ready!");break;case"bomb":this.handleBombUpgrade(ht,"Bomb launcher deployed!");break;case"bombMk2":this.handleBombUpgrade(X,"Bombs Mk II primed!");break;case"bombMk3":this.handleBombUpgrade(kt,"Bombs Mk III unleashed!");break;case"sword":this.handleSwordUpgrade(ct,"Sword technique mastered!");break;case"swordMk2":this.handleSwordUpgrade(q,"Sword Mk II swings wider!");break;case"swordMk3":this.handleSwordUpgrade($,"Sword Mk III hits harder!");break;case"swordMk4":this.handleSwordUpgrade(Y,"Sword Mk IV extends reach!");break;case"swordMk5":this.handleSwordUpgrade(Et,"Sword Mk V slices everything!");break;case"area1":this.applyAreaUpgrade();break;case"damage1":this.applyDamageUpgrade();break}this.hooks.onUpgradeApplied(),this.closeMenu()}closeMenu(){this.clearOverlay(),this.active=!1,this.hooks.onMenuClosed()}clearOverlay(){this.overlay.forEach(t=>t.destroy()),this.overlay=[]}getAvailableUpgrades(){const t=this.hero.weaponIds.length===0,e=pt.filter(o=>this.hero.upgrades.includes(o.id)||!(o.requires?.every(h=>this.hero.upgrades.includes(h))??!0)||o.weaponId&&o.level&&o.level>1&&!!!this.hero.upgrades.find(u=>{const c=pt.find(d=>d.id===u);return c?.level===o.level-1&&c.weaponId===o.weaponId})?!1:t?o.category==="WEAPON_NEW":!0);function i(o){return o.length>0?o[l.Math.Between(0,o.length-1)]:null}const s=i(e.filter(o=>o.category==="WEAPON_UPGRADE"))??i(e.filter(o=>o.category==="WEAPON_NEW"))??i(e),a=i(e.filter(o=>o.category==="PASSIVE_UPGRADE"))??i(e.filter(o=>o.category==="PASSIVE_NEW"))??i(e.filter(o=>o.id!==s?.id)),n=i(e.filter(o=>o.id!==s?.id&&o.id!==a?.id));return[s,a,n].filter(o=>o)}handleAuraUpgrade(t,e){this.hero.hasAura=!0,this.hero.weaponIds.includes("aura")||this.hero.weaponIds.push("aura"),this.hero.aura.setVisible(!0),this.hero.aura.setRadius(t.area*this.hero.areaMultiplier),this.combat.setAuraWeapon(t),this.hooks.onShowMessage(e)}handlePistolUpgrade(t,e){this.hero.weaponIds.includes("pistol")||this.hero.weaponIds.push("pistol"),this.combat.setPistolWeapon(t),this.hooks.onShowMessage(e)}handleBombUpgrade(t,e){this.hero.weaponIds.includes("bomb")||this.hero.weaponIds.push("bomb"),this.combat.setBombWeapon(t),this.hooks.onShowMessage(e)}handleSwordUpgrade(t,e){this.hero.weaponIds.includes("sword")||this.hero.weaponIds.push("sword"),this.combat.setSwordWeapon(t),this.hooks.onShowMessage(e)}applyAreaUpgrade(){this.hero.areaMultiplier*=1.1,this.combat.refreshWeapons(),this.hooks.onShowMessage("Area increased by 10%!")}applyDamageUpgrade(){this.hero.damageMultiplier*=1.1,this.combat.refreshWeapons(),this.hooks.onShowMessage("Damage increased by 10%!")}}const Qt=F*.3,R={duration:100,r:120,g:200,b:255},C={duration:100,r:80,g:180,b:255},P=U*3;class te{scene;xpManager;hooks;healPacks=[];magnetPickups=[];constructor(t,e,i){this.scene=t,this.xpManager=e,this.hooks=i}spawnHealPack(t){const e=l.Math.FloatBetween(t.left+P,t.right-P),i=l.Math.FloatBetween(t.top+P,t.bottom-P),s=E,a=this.scene.add.image(e,i,y.key,M.healPotion);a.setDisplaySize(s,s),a.setTint(15753280),a.setData("radius",s/2),this.healPacks.push(a)}spawnMagnetPickup(t){if(this.magnetPickups.some(n=>n.active))return;const e=l.Math.FloatBetween(t.left+P,t.right-P),i=l.Math.FloatBetween(t.top+P,t.bottom-P),s=E,a=this.scene.add.image(e,i,y.key,M.portalOpens);a.setDisplaySize(s,s),a.setTint(4367861),a.setData("radius",s/2),a.setDepth(.2),this.magnetPickups.push(a)}update(t){const e=this.hooks.getHero(),i=e.sprite,s=e.radius,a=i.x,n=i.y;this.healPacks=this.healPacks.filter(o=>{if(!o.active)return o.destroy(),!1;const h=o.getData("radius")??E/2;return l.Math.Distance.Between(o.x,o.y,a,n)<h+s?(this.collectHealPack(o),!1):this.isOutOfBounds(o.x,o.y,t)?(o.destroy(),!1):!0}),this.magnetPickups=this.magnetPickups.filter(o=>{if(!o.active)return o.destroy(),!1;const h=o.getData("radius")??E/2;return l.Math.Distance.Between(o.x,o.y,a,n)<h+s?(this.collectMagnetPickup(o),!1):this.isOutOfBounds(o.x,o.y,t)?(o.destroy(),!1):!0})}destroy(){this.healPacks.forEach(t=>t.destroy()),this.healPacks=[],this.magnetPickups.forEach(t=>t.destroy()),this.magnetPickups=[]}collectHealPack(t){const e=this.hooks.getHero();Nt(e,Qt),this.scene.cameras.main.flash(C.duration,C.r,C.g,C.b,!1),t.destroy(),this.hooks.onHeroHealed()}collectMagnetPickup(t){this.xpManager.activateMagnet(),this.scene.cameras.main.flash(R.duration,R.r,R.g,R.b,!1),t.destroy(),this.hooks.onMagnetActivated()}isOutOfBounds(t,e,i){const s=T;return t<i.left-s||t>i.right+s||e<i.top-s||e>i.bottom+s}}class ee{width;height=6;padding=1;bg;fill;hero;constructor(t,e){this.hero=e;const i=this.getOffsetY();this.width=e.sprite.displayWidth,this.bg=t.add.rectangle(e.sprite.x,e.sprite.y-i,this.width,this.height,0,.7).setOrigin(.5).setDepth(1),this.fill=t.add.rectangle(e.sprite.x-this.width/2+this.padding,this.bg.y,this.width-this.padding*2,this.height-this.padding*2,5025616).setOrigin(0,.5).setDepth(1.1),this.updateValue(e.hp,e.maxHp)}syncPosition(){const t=this.hero.sprite.x,e=this.hero.sprite.y+this.getOffsetY(),i=t-this.width/2+this.padding;this.bg.setPosition(t,e),this.fill.setPosition(i,e)}updateValue(t,e){const i=l.Math.Clamp(e===0?0:t/e,0,1),s=Math.max(0,this.width-this.padding*2);this.fill.displayWidth=s*i,i>.6?this.fill.setFillStyle(5025616):i>.3?this.fill.setFillStyle(16761095):this.fill.setFillStyle(16732754)}destroy(){this.bg.destroy(),this.fill.destroy()}getOffsetY(){return this.hero.sprite.displayHeight/2+4}}class _ extends l.Scene{static exitHandler;hero;inputController;enemies=[];background;worldBounds=It;heroHpBar;infoText;weaponHud;kills=0;wave=0;combat;xpManager;enemyManager;waveManager;pickupManager;upgradeManager;pauseButton;exitButton;isPaused=!1;totalXp=0;level=1;nextLevelXp=100;pendingLevelUps=0;supportTimersStarted=!1;pickupTimers=[];wavesOver=!1;isGameOver=!1;exitHandled=!1;gameOverTitle;gameOverStatsText;exitButtonDefaultPosition={x:0,y:0};exitButtonDefaultOrigin={x:1,y:0};static registerExitHandler(t){_.exitHandler=t}preload(){this.textures.exists(y.key)||this.load.spritesheet(y.key,y.url,{frameWidth:y.frameWidth,frameHeight:y.frameHeight,spacing:y.spacing})}create(){const{width:t,height:e}=this.scale;if(this.isGameOver=!1,this.exitHandled=!1,this.gameOverTitle?.destroy(),this.gameOverStatsText?.destroy(),this.gameOverTitle=void 0,this.gameOverStatsText=void 0,this.cameras.main.setBackgroundColor("#101014"),this.time.timeScale=1,this.isPaused=!1,!this.textures.exists("hordes-grid")){const s=this.add.graphics();s.setVisible(!1),s.fillStyle(1118493,1),s.fillRect(0,0,96,96),s.lineStyle(2,1908012,.6),s.strokeRect(0,0,96,96),s.lineStyle(1,2041148,.5),s.beginPath(),s.moveTo(48,0),s.lineTo(48,96),s.moveTo(0,48),s.lineTo(96,48),s.strokePath(),s.generateTexture("hordes-grid",96,96),s.destroy()}this.background=this.add.tileSprite(t/2,e/2,t,e,"hordes-grid"),this.background.setOrigin(.5),this.background.setScrollFactor(0),this.background.setDepth(-2),this.hero=Wt(this),this.heroHpBar=new ee(this,this.hero),this.enemies=[],this.xpManager=new Xt(this),this.pickupManager=new te(this,this.xpManager,{getHero:()=>this.hero,onHeroHealed:()=>this.updateHud(),onMagnetActivated:()=>{this.showMagnetPickup(),this.updateHud()}}),this.enemyManager=new qt(this,this.enemies),this.waveManager=new $t(this,this.enemyManager,{getHero:()=>this.hero,onWaveAdvanced:s=>{this.wave=s}}),this.ensureEnemyWalkAnimation(),this.kills=0,this.wave=0,this.totalXp=0,this.level=1,this.nextLevelXp=this.getNextLevelXp(this.level),this.pendingLevelUps=0,this.hero.hasAura=!1,this.hero.aura.setVisible(!1),this.inputController=Vt(this),this.combat=new Gt(this,{hero:this.hero,getEnemies:()=>this.enemies,onEnemyKilled:(s,a)=>{this.kills+=1,this.xpManager.spawn(s.x,s.y,a.xp)}}),this.upgradeManager=new Zt(this,this.hero,this.combat,{onMenuOpened:()=>this.pauseForUpgrade(),onMenuClosed:()=>this.onUpgradeMenuClosed(),onUpgradeApplied:()=>this.updateHud(),onShowMessage:s=>this.showWeaponUpgrade(s)}),this.events.once(l.Scenes.Events.SHUTDOWN,()=>{this.combat.reset(),this.inputController.destroy(),this.xpManager.destroyAll(),this.upgradeManager.destroy(),this.heroHpBar.destroy(),this.pickupManager.destroy(),this.waveManager.destroy(),this.clearSupportTimers(),this.weaponHud?.destroy(!0)});const i=this.cameras.main;i.setBounds(-this.worldBounds,-this.worldBounds,this.worldBounds*2,this.worldBounds*2),i.startFollow(this.hero.sprite,!0,1,1),i.centerOn(0,0),this.infoText=this.add.text(16,16,"Wave 0",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px"}).setDepth(2),this.infoText.setScrollFactor(0),this.weaponHud=new J(this,this.infoText,this.hero),this.updateHud(),this.pauseButton=this.add.text(t-16,16,"Pause",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#30304888",padding:{x:8,y:4}}).setOrigin(1,0).setDepth(2).setScrollFactor(0).setInteractive({useHandCursor:!0}),this.pauseButton.on("pointerdown",()=>this.togglePause()),this.exitButton=this.add.text(t-16,this.pauseButton.y+this.pauseButton.displayHeight+12,"Exit",{color:"#ff8a80",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#30304888",padding:{x:8,y:4}}).setOrigin(1,0).setDepth(2).setScrollFactor(0).setInteractive({useHandCursor:!0}),this.exitButton.on("pointerdown",()=>this.handleExit()),this.exitButtonDefaultPosition={x:this.exitButton.x,y:this.exitButton.y},this.exitButtonDefaultOrigin={x:this.exitButton.originX,y:this.exitButton.originY},this.hidePauseHud(),this.hero.weaponIds.length===0?(this.pendingLevelUps=Math.max(this.pendingLevelUps,1),this.tryOpenUpgradeMenu()):this.maybeStartWaves(),this.game.events.on("wavesOver",()=>this.wavesOver=!0)}update(t,e){const i=e/1e3;if(this.isPaused)return;const s=this.inputController.getDirection();Ht(this.hero,s,Z,i);const a=this.cameras.main;this.background.tilePositionX=a.scrollX,this.background.tilePositionY=a.scrollY,this.heroHpBar.syncPosition();const n=this.cameras.main.worldView;this.enemies=this.enemyManager.update(this.hero,i,n,(o,h)=>{this.handleHeroHit(o,h)}),this.enemies.length===0&&this.wavesOver&&this.showGameOverHud("complete"),this.combat.update(i,n),this.xpManager.update(this.hero.sprite.x,this.hero.sprite.y,n,o=>this.awardXp(o)),this.pickupManager.update(n),this.enemyManager.resolveOverlaps()}maybeStartWaves(){this.hero.weaponIds.length!==0&&(this.waveManager.isRunning()||(this.waveManager.start(),this.startSupportTimers()))}startSupportTimers(){if(this.supportTimersStarted)return;this.supportTimersStarted=!0;const t=this.time.addEvent({delay:1e4,callback:()=>this.pickupManager.spawnHealPack(this.cameras.main.worldView),loop:!0,startAt:4e3}),e=this.time.addEvent({delay:6e4,callback:()=>this.pickupManager.spawnMagnetPickup(this.cameras.main.worldView),loop:!0,startAt:0});this.pickupTimers.push(t,e)}clearSupportTimers(){this.pickupTimers.forEach(t=>t.remove()),this.pickupTimers=[],this.supportTimersStarted=!1}handleHeroHit(t,e){if(this.hero.hp<=0)return;const i=this.time.now,s=t.getData("lastHit");if(s&&i-s<1e3)return;t.setData("lastHit",i);const a=e.damage,n=Ut(this.hero,a);this.cameras.main.flash(120,255,64,64,!1),this.updateHud(),n<=0&&(this.cameras.main.shake(250,.02),this.time.delayedCall(260,()=>this.showGameOverHud("killed")))}awardXp(t){if(t>0){for(this.totalXp+=t;this.totalXp>=this.nextLevelXp;)this.level+=1,this.pendingLevelUps+=1,this.showLevelUp(),this.nextLevelXp+=this.getNextLevelXp(this.level);this.tryOpenUpgradeMenu()}this.updateHud()}tryOpenUpgradeMenu(){if(this.pendingLevelUps<=0||this.upgradeManager.isActive())return;if(!this.upgradeManager.openMenu()){this.pendingLevelUps=0;return}this.pendingLevelUps-=1}handleExit(){if(this.exitHandled)return;this.exitHandled=!0,this.exitButton&&this.exitButton.disableInteractive(),this.gameOverTitle?.destroy(),this.gameOverStatsText?.destroy(),this.gameOverTitle=void 0,this.gameOverStatsText=void 0;const t=_.exitHandler;t&&t({kills:this.kills,waves:this.wave+1})}pauseForUpgrade(){this.isPaused=!0,this.time.timeScale=0,this.pauseButton&&(this.pauseButton.disableInteractive(),this.pauseButton.setText("Upgrade")),this.hidePauseHud()}resumeFromUpgrade(){this.isPaused=!1,this.time.timeScale=1,this.pauseButton&&(this.pauseButton.setText("Pause"),this.pauseButton.setInteractive({useHandCursor:!0})),this.hidePauseHud()}onUpgradeMenuClosed(){this.resumeFromUpgrade(),this.pendingLevelUps>0&&this.tryOpenUpgradeMenu(),this.upgradeManager.isActive()||this.maybeStartWaves()}showLevelUp(){const t=this.add.text(this.scale.width/2,96,`Level ${this.level}!`,{color:"#ffe082",fontFamily:"monospace",fontSize:"24px",backgroundColor:"#1a1a25bb",padding:{x:12,y:6}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:t,alpha:0,y:t.y-32,duration:900,ease:"Sine.easeOut",onComplete:()=>t.destroy()}),this.cameras.main.flash(160,140,220,80,!1)}showWeaponUpgrade(t){const e=this.add.text(this.scale.width/2,140,t,{color:"#ffab40",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#222234dd",padding:{x:10,y:4}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:e,alpha:0,y:e.y-28,duration:900,ease:"Sine.easeOut",onComplete:()=>e.destroy()})}showMagnetPickup(){const t=this.add.text(this.scale.width/2,180,"Magnet activated!",{color:"#8c9eff",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#1f1f32dd",padding:{x:10,y:4}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:t,alpha:0,y:t.y-24,duration:900,ease:"Sine.easeOut",onComplete:()=>t.destroy()})}showGameOverHud(t){if(this.isGameOver)return;this.isGameOver=!0,this.isPaused=!0,this.time.timeScale=0,this.pauseButton&&(this.pauseButton.disableInteractive(),this.pauseButton.setVisible(!1));const e=t==="killed"?"Game Over":"Complete",i=t==="killed"?"#ff5252":"#69f0ae";this.gameOverTitle?.destroy(),this.gameOverStatsText?.destroy(),this.gameOverTitle=this.add.text(this.scale.width/2,this.scale.height/2-48,e,{color:i,fontFamily:"monospace",fontSize:"36px",backgroundColor:"#1a1a25ee",padding:{x:18,y:10}}).setOrigin(.5).setScrollFactor(0).setDepth(6),this.gameOverStatsText=this.add.text(this.scale.width/2,this.scale.height/2+4,`Wave ${this.wave+1} | Kills ${this.kills}`,{color:"#f5f5f5",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#1a1a25cc",padding:{x:14,y:6}}).setOrigin(.5).setScrollFactor(0).setDepth(6),this.showPauseHud(),this.exitButton&&(this.exitButton.setPosition(this.scale.width/2,this.scale.height/2+64),this.exitButton.setOrigin(.5,0),this.exitButton.setDepth(6),this.exitButton.setVisible(!0),this.exitButton.setInteractive({useHandCursor:!0}))}showPauseHud(){this.exitButton&&(this.isGameOver||(this.exitButton.setOrigin(this.exitButtonDefaultOrigin.x,this.exitButtonDefaultOrigin.y),this.exitButton.setPosition(this.exitButtonDefaultPosition.x,this.exitButtonDefaultPosition.y),this.exitButton.setDepth(2)),this.exitButton.setVisible(!0),this.exitButton.setInteractive({useHandCursor:!0}))}hidePauseHud(){!this.exitButton||this.isGameOver||(this.exitButton.setVisible(!1),this.exitButton.disableInteractive())}getNextLevelXp(t){return Math.ceil(Tt*Math.pow(_t,t-1))}togglePause(){this.upgradeManager.isActive()||this.isGameOver||(this.isPaused=!this.isPaused,this.pauseButton.setText(this.isPaused?"Resume":"Pause"),this.time.timeScale=this.isPaused?0:1,this.isPaused?this.showPauseHud():this.hidePauseHud())}updateHud(){this.infoText.setText(`Wave ${this.wave+1} | LVL ${this.level} (${this.totalXp}/${this.nextLevelXp})
Kills ${this.kills}`),this.weaponHud.refresh(),this.heroHpBar.updateValue(this.hero.hp,this.hero.maxHp)}ensureEnemyWalkAnimation(){if(!this.textures.exists(y.key)||this.anims.exists("enemy-walk"))return;const t=[M.mobWalk1,M.mobWalk2].map(e=>({key:y.key,frame:e}));this.anims.create({key:"enemy-walk",frames:t,frameRate:6,repeat:-1})}}class J extends l.GameObjects.Container{static frames={sword:M.sword1,pistol:M.pistol1,bomb:M.bomb,aura:M.aura};static upgradeChains={aura:["aura","auraMk2","auraMk3","auraMk4","auraMk5"],pistol:["pistol","pistolMk2","pistolMk3","pistolMk4","pistolMk5"],bomb:["bomb","bombMk2","bombMk3"],sword:["sword","swordMk2","swordMk3","swordMk4","swordMk5"]};hero;infoText;constructor(t,e,i){super(t,16,e.y+e.height+12),this.hero=i,this.infoText=e,this.setDepth(2),this.setScrollFactor(0),t.add.existing(this)}refresh(){this.removeAll(!0),this.setPosition(16,this.infoText.y+this.infoText.height+12);const t=20;this.hero.weaponIds.forEach((e,i)=>{const s=J.frames[e];if(s===void 0)return;const a=this.getWeaponLevel(e),n=new l.GameObjects.Container(this.scene,i*t*1.5,0),o=new l.GameObjects.Rectangle(this.scene,0,0,t,t,1710635,.65).setOrigin(0).setStrokeStyle(1,16777215,.2),p=a===1?16777215:a===2?16777045:a===3?5635925:a===4?5592575:16733525,m=new l.GameObjects.Sprite(this.scene,t/2,t/2,y.key,s).setOrigin(.5).setDisplaySize(t,t).setTint(p);n.add([o,m]),this.add(n)})}destroy(t){this.removeAll(!0),super.destroy(t)}getWeaponLevel(t){const e=J.upgradeChains[t];if(!e)return 1;for(let i=e.length-1;i>=0;i-=1)if(this.hero.upgrades.includes(e[i]))return i+1;return 1}}const At=600,Pt=800,se={type:l.AUTO,width:At,height:Pt,backgroundColor:"#101014",scene:_,fps:{target:60},scale:{mode:l.Scale.ScaleModes.FIT,autoCenter:l.Scale.Center.CENTER_BOTH}},Ot="hordesHighScores",Dt=5,ie=()=>{try{const r=window.localStorage.getItem(Ot);if(!r)return[];const t=JSON.parse(r);return Array.isArray(t)?t.sort((e,i)=>i.kills!==e.kills?i.kills-e.kills:i.waves!==e.waves?i.waves-e.waves:i.timestamp-e.timestamp).slice(0,Dt):[]}catch(r){return console.warn("Failed to read Hordes high scores",r),[]}},ae=r=>{try{window.localStorage.setItem(Ot,JSON.stringify(r))}catch(t){console.warn("Failed to save Hordes high scores",t)}},oe=(r,t)=>{const e=[...r,{...t,timestamp:Date.now()}];return e.sort((i,s)=>s.kills!==i.kills?s.kills-i.kills:s.waves!==i.waves?s.waves-i.waves:s.timestamp-i.timestamp),e.slice(0,Dt)},he=()=>{const r=k.useRef(null),t=k.useRef(null),[e,i]=k.useState(!1),[s,a]=k.useState(null),[n,o]=k.useState([]);k.useEffect(()=>{o(ie())},[]);const h=k.useCallback(c=>{a(c),i(!1),o(d=>{const g=oe(d,c);return ae(g),g})},[]);k.useEffect(()=>{if(!e){_.registerExitHandler(void 0),t.current&&(t.current.destroy(!0),t.current=null);return}const c=r.current;if(!c)return;_.registerExitHandler(h);const d=At*Pt,g=c.clientWidth/c.clientHeight,p=Math.sqrt(d)*Math.sqrt(g),m=Math.sqrt(d)/Math.sqrt(g);console.log("RATIO",g,p,"X",m,";",c.clientWidth,"X",c.clientHeight);const v=new l.Game({parent:c,...se,width:p,height:m});t.current=v;const b=()=>{},O=new ResizeObserver(b);return O.observe(c),()=>{_.registerExitHandler(void 0),O?.disconnect(),v.destroy(!0),t.current=null}},[h,e]);const u=k.useCallback(()=>{a(null),i(!0)},[]);return e?f.jsx("div",{className:"h-screen w-screen overflow-hidden bg-[#101014] text-gray-100",children:f.jsx("div",{ref:r,className:"h-full w-full"})}):f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-start bg-gray-900 px-6 py-6 pb-28 text-gray-100",children:[f.jsx("h1",{className:"mb-4 text-3xl font-semibold",children:"Hordes"}),f.jsx("div",{className:"flex w-full max-w-[1100px] flex-col gap-6 lg:flex-row",children:f.jsxs("div",{className:"flex-1 rounded-lg border border-[#252545] bg-[#161626] p-5",children:[f.jsx("h2",{className:"mb-3 text-xl font-semibold",children:"High Scores"}),n.length===0?f.jsx("p",{className:"text-sm opacity-70",children:"No runs recorded yet. Be the first!"}):f.jsxs("table",{className:"w-full border-collapse text-sm",children:[f.jsx("thead",{children:f.jsxs("tr",{className:"border-b border-[#2c2c45] text-left",children:[f.jsx("th",{className:"px-1 py-1",children:"#"}),f.jsx("th",{className:"px-1 py-1",children:"Kills"}),f.jsx("th",{className:"px-1 py-1",children:"Waves"}),f.jsx("th",{className:"px-1 py-1",children:"Date"})]})}),f.jsxs("tbody",{children:[s&&f.jsxs("tr",{children:[f.jsx("td",{className:"px-1 py-1",children:"Last"}),f.jsx("td",{className:"px-1 py-1",children:s.kills}),f.jsx("td",{className:"px-1 py-1",children:s.waves})]}),n.map((c,d)=>f.jsxs("tr",{className:"border-b border-white/5",children:[f.jsx("td",{className:"px-1 py-2",children:d+1}),f.jsx("td",{className:"px-1 py-2",children:c.kills}),f.jsx("td",{className:"px-1 py-2",children:c.waves}),f.jsx("td",{className:"px-1 py-2",children:new Date(c.timestamp).toLocaleDateString()})]},`${c.timestamp}-${d}`))]})]})]})}),f.jsx(Bt,{to:"/",className:`mt-6 inline-flex items-center justify-center rounded-md border border-slate-600
          bg-slate-800 px-4 py-2 text-sm font-medium text-slate-100 transition hover:bg-slate-700`,children:"Back to main page"})]}),f.jsx("button",{onClick:u,className:`fixed bottom-6 left-1/2 z-50 w-[calc(100%-3rem)] max-w-md -translate-x-1/2 transform rounded-md
        bg-green-600 px-4 py-3 text-base font-semibold text-white shadow-lg transition hover:bg-green-500`,children:"Play"})]})};export{he as default};
