import{r as k,j as f}from"./index-CIJZZGTY.js";import{P as u}from"./phaser-B61OQUcB.js";class ${swordElapsed=0;activeSwordSwing=null;scene;context;damageEnemy;stats;constructor(e,t,a,s){this.scene=e,this.context=t,this.stats=a,this.damageEnemy=s}update(e,t,a){this.activeSwordSwing&&this.updateActiveSwordSwing(e,t);const s=this.context.hero;if(s.hp<=0||!s.weaponIds.includes("sword")||(this.swordElapsed+=e,this.activeSwordSwing)||this.swordElapsed<this.stats.cooldown)return;const i=s.direction;if(!i||i.lengthSq()<1e-4)return;this.swordElapsed=0;const o=s.sprite,n=i.clone().normalize(),h=u.Math.RadToDeg(Math.atan2(n.y,n.x)),c=this.stats.sectorAngle/2,r=this.scene.add.graphics({x:o.x,y:o.y}),l=()=>{r.setPosition(o.x,o.y)};let m=!1;const p=()=>{m||(m=!0,this.scene.events.off(u.Scenes.Events.POST_UPDATE,l),this.scene.events.off(u.Scenes.Events.SHUTDOWN,p),r.destroy(),this.activeSwordSwing&&this.activeSwordSwing.gfx===r&&(this.activeSwordSwing=null))};l(),this.scene.events.on(u.Scenes.Events.POST_UPDATE,l),this.scene.events.once(u.Scenes.Events.SHUTDOWN,p),r.setDepth(-.3),r.fillStyle(16766287,.35),r.beginPath(),r.slice(0,0,this.stats.area,u.Math.DegToRad(h-c),u.Math.DegToRad(h+c),!1),r.fillPath(),this.scene.tweens.add({targets:r,alpha:0,scale:1.05,duration:500,onComplete:p}),this.activeSwordSwing={gfx:r,angleDeg:h,halfArc:c,radius:this.stats.area,damage:this.stats.damage,remaining:.5,hitEnemies:new Set,cleanup:p},this.updateActiveSwordSwing(0,t)}reset(){this.swordElapsed=0,this.activeSwordSwing&&(this.activeSwordSwing.cleanup(),this.activeSwordSwing=null)}updateActiveSwordSwing(e,t){const a=this.activeSwordSwing;if(!a)return;if(a.remaining-=e,a.remaining<=0){a.cleanup(),this.activeSwordSwing=null;return}const i=this.context.hero.sprite;for(const o of t){if(a.hitEnemies.has(o))continue;const n=o.getData("mob");if(!o.active||!n)continue;const h=o.x-i.x,c=o.y-i.y;if(Math.hypot(h,c)>a.radius+n.size/2)continue;const l=u.Math.RadToDeg(Math.atan2(c,h)),m=u.Math.Angle.ShortestBetween(a.angleDeg,l);Math.abs(m)>a.halfArc||(a.hitEnemies.add(o),this.damageEnemy(o,a.damage,n))}}}const J="/assets/monochrome-transparent-D-zEE-7P.png",O=49,b={key:"enemy-kenney",url:J,frameWidth:16,frameHeight:16,spacing:1},B={portalOpens:2*O+45,hero:4*O+30,mobWalk1:7*O+18,mobWalk2:7*O+19,bomb:9*O+45,healPotion:13*O+32},Z=2e4,U=220,H=14,T=100,Q=U*.5,C=H,w=T*.2,z=T*.05,q=20,ee=2,v=H*2,D=260,te=q*ee,se=1.3;class ae{bombElapsed=0;bombs=[];scene;context;stats;damageEnemy;constructor(e,t,a,s){this.scene=e,this.context=t,this.stats=a,this.damageEnemy=s}update(e,t,a){for(this.bombElapsed+=e;this.bombElapsed>=this.stats.cooldown;)this.bombElapsed-=this.stats.cooldown,this.spawnBomb(this.stats);const s=this.scene.time.now;this.bombs=this.bombs.filter(i=>{if(!i.sprite.active)return i.sprite.destroy(),!1;const{detonateAt:o}=i,n=o-s,h=V;if(n<=0)return this.detonateBomb(i,t),!1;const c=1-n/h;return i.sprite.setAlpha(.6+Math.sin(c*Math.PI*4)*.2),!0})}spawnBomb(e){const{sprite:t}=this.context.hero,a=this.scene.add.image(t.x,t.y,b.key,B.bomb);a.setDepth(-.5),a.setDisplaySize(v,v),a.setTint(16740419),a.setAlpha(.9);const s=this.scene.time.now+V;this.bombs.push({sprite:a,detonateAt:s,weapon:e})}detonateBomb(e,t){const{sprite:a,weapon:s}=e,i=this.scene.add.circle(a.x,a.y,s.area,16755520,.35);i.setDepth(-.4),this.scene.tweens.add({targets:i,alpha:0,scale:1.4,duration:320,onComplete:()=>i.destroy()});const o=s.area,n=s.damage;for(const h of t){const c=h.getData("mob");if(!h.active||!c)continue;u.Math.Distance.Between(a.x,a.y,h.x,h.y)<=o+c.size/2&&this.damageEnemy(h,n,c)}a.destroy()}reset(){this.bombElapsed=0,this.bombs.forEach(e=>e.sprite.destroy()),this.bombs=[]}}const V=2e3;class ie{scene;context;stats;damageEnemy;constructor(e,t,a,s){this.scene=e,this.context=t,this.stats=a,this.damageEnemy=s}update(e,t,a){t.forEach(s=>{const i=s.getData("mob");if(!s.active||!i)return!1;const o=this.context.hero.sprite.x-s.x,n=this.context.hero.sprite.y-s.y,h=Math.hypot(o,n)||.001;this.applyAuraDamage(s,h,i)})}applyAuraDamage(e,t,a){if(t>this.stats.area+a.size/2)return!1;const s=this.scene.time.now,i=e.getData("lastAuraTick"),o=this.stats.cooldown*1e3;if(i&&s-i<o)return!1;e.setData("lastAuraTick",s),this.damageEnemy(e,this.stats.damage,a);const n=this.context.hero.sprite,h=e.x-n.x,c=e.y-n.y,r=Math.hypot(h,c)||1,l=e.getData("auraKnockback")??40,m=Math.max(l/2,5);e.setData("auraKnockback",m),e.x+=h/r*l,e.y+=c/r*l;const p=e.getData("hpText");p&&p.active&&p.setPosition(e.x,e.y-a.size/2-8)}reset(){}}class oe{scene;context;stats;damageEnemy;bullets=[];shootElapsed=0;constructor(e,t,a,s){this.scene=e,this.context=t,this.stats=a,this.damageEnemy=s}update(e,t,a){this.bullets=this.bullets.filter(s=>{const i=s.sprite;if(!i.active)return!1;if(i.x+=s.vx*e,i.y+=s.vy*e,i.x<a.left-D||i.x>a.right+D||i.y<a.top-D||i.y>a.bottom+D)return i.destroy(),!1;for(const o of t){const n=o.getData("mob");if(!(!o.active||!n)&&!s.hitEnemies.has(o)&&u.Math.Distance.Between(i.x,i.y,o.x,o.y)<n.size/2+s.radius&&(s.hitEnemies.add(o),this.damageEnemy(o,this.stats.damage,n),i.x+=s.vx*e*.3,i.y+=s.vy*e*.3,s.piercesLeft-=1,s.piercesLeft<=0))return i.destroy(),!1}return!0}),this.context.hero.hp>0&&this.tickAutoFire(e)}tickAutoFire(e){if(!this.context.getEnemies().some(m=>m.active)||!this.context.hero.weaponIds.includes("pistol")||(this.shootElapsed+=e,this.shootElapsed<this.stats.cooldown))return;this.shootElapsed=0;const a=this.findNearestEnemy();if(!a)return;const{sprite:s}=this.context.hero,i=a.x-s.x,o=a.y-s.y,n=Math.hypot(i,o);if(!n)return;const h=this.stats.area,c=this.scene.add.circle(s.x,s.y,h,16771899),r=i/n*j,l=o/n*j;this.bullets.push({sprite:c,vx:r,vy:l,radius:h,piercesLeft:this.stats.pierce,hitEnemies:new Set})}findNearestEnemy(){const{sprite:e}=this.context.hero,t=this.context.getEnemies();let a,s=Number.POSITIVE_INFINITY;for(const i of t){if(!i.active)continue;const o=u.Math.Distance.Between(e.x,e.y,i.x,i.y);o<s&&(a=i,s=o)}return a}reset(){this.bullets.forEach(e=>e.sprite.destroy()),this.bullets=[],this.shootElapsed=0}}const j=U*3;class ne{scene;config;context;sword=null;bomb=null;aura=null;pistol=null;constructor(e,t,a){this.scene=e,this.config=t,this.context=a,this.setSwordWeapon(this.config.swordWeapon??null),this.setBombWeapon(this.config.bombWeapon??null),this.setAuraWeapon(this.config.auraWeapon??null),this.setPistolWeapon(this.config.pistolWeapon??null)}reset(){this.sword?.reset(),this.bomb?.reset(),this.aura?.reset(),this.pistol?.reset()}update(e,t){const a=this.context.getEnemies();this.pistol?.update(e,a,t),this.bomb?.update(e,a,t),this.sword?.update(e,a,t),this.aura?.update(e,a,t)}damageEnemy(e,t,a){if(!e.active)return!1;const i=(e.getData("hp")??a.health)-t;e.setData("hp",i);const o=e.getData("hpText");return o&&o.active&&o.setText(`${Math.max(i,0)}`),i<=0?(this.context.onEnemyKilled(e,a),e.setActive(!1),e.destroy(),!0):!1}setPistolWeapon(e){this.pistol?.reset(),this.config.pistolWeapon=e,e?this.pistol=new oe(this.scene,this.context,e,this.damageEnemy):this.pistol=null,this.pistol?.reset()}setAuraWeapon(e){this.aura?.reset(),this.config.auraWeapon=e??null,e?this.aura=new ie(this.scene,this.context,e,this.damageEnemy):this.aura=null,this.aura?.reset()}setBombWeapon(e){this.bomb?.reset(),this.config.bombWeapon=e??null,e?this.bomb=new ae(this.scene,this.context,e,this.damageEnemy):this.bomb=null,this.bomb?.reset()}setSwordWeapon(e){this.sword?.reset(),this.config.swordWeapon=e,e?this.sword=new $(this.scene,this.context,e,this.damageEnemy):this.sword=null,this.sword?.reset()}}const _=50;function re(d){const e=d.add.sprite(0,0,b.key,B.hero);e.setOrigin(.5),e.setDisplaySize(H*2,H*2),e.setTint(5025616),e.setDepth(.2),e.setData("radius",H);const t=d.add.circle(e.x,e.y,_,16771899,.1);return t.setDepth(-1),t.setVisible(!1),{sprite:e,aura:t,radius:H,maxHp:T,hp:T,hasAura:!1,upgrades:[],weaponIds:[],direction:new u.Math.Vector2(0,0)}}function he(d,e,t,a){d.sprite.x+=e.x*t*a,d.sprite.y+=e.y*t*a,d.aura.setPosition(d.sprite.x,d.sprite.y),e.lengthSq()>1e-4&&d.direction.copy(e)}function ce(d,e){return d.hp=Math.max(0,d.hp-e),d.hp}function le(d,e){return d.hp=Math.min(d.maxHp,d.hp+e),d.hp}const A=68,de=4;function pe(d){const e=d.input.keyboard.createCursorKeys(),t=new u.Math.Vector2,a=new u.Math.Vector2;let s,i,o;const n=46,h=20,c=()=>{s&&i||(s=d.add.circle(120,d.scale.height-120,n,16777215,.1),s.setStrokeStyle(2,16777215,.35),s.setScrollFactor(0),s.setDepth(5),s.setVisible(!1),i=d.add.circle(s.x,s.y,h,16777215,.35),i.setScrollFactor(0),i.setDepth(6),i.setVisible(!1))},r=()=>{o=void 0,t.set(0,0),s&&i&&(i.setPosition(s.x,s.y),s.setVisible(!1),i.setVisible(!1))},l=g=>{o===void 0&&g.primaryDown&&(c(),!(!s||!i)&&(o=g.id,s.setPosition(g.x,g.y),i.setPosition(g.x,g.y),s.setVisible(!0),i.setVisible(!0),t.set(0,0)))},m=g=>{if(o!==g.id||!s||!i)return;const y=g.x-s.x,S=g.y-s.y,M=Math.hypot(y,S);if(M<=A)i.setPosition(g.x,g.y),t.set(y/A,S/A);else{const W=Math.atan2(S,y),F=Math.cos(W)*A,L=Math.sin(W)*A;i.setPosition(s.x+F,s.y+L),t.set(F/A,L/A)}M<de&&t.set(0,0)},p=g=>{o===g.id&&r()};return d.input.on("pointerdown",l),d.input.on("pointermove",m),d.input.on("pointerup",p),d.input.on("pointerupoutside",p),{cursors:e,getDirection(){a.copy(t),e.left?.isDown&&(a.x-=1),e.right?.isDown&&(a.x+=1),e.up?.isDown&&(a.y-=1),e.down?.isDown&&(a.y+=1);const g=a.length();return g>1&&a.scale(1/g),a.clone()},destroy(){r(),d.input.off("pointerdown",l),d.input.off("pointermove",m),d.input.off("pointerup",p),d.input.off("pointerupoutside",p),s?.destroy(),i?.destroy(),s=void 0,i=void 0,o=void 0}}}const ue=v*4,ge=v,X=U*1.5,K=100,I=v*.5;class me{scene;crystals=[];constructor(e){this.scene=e}spawn(e,t,a){const s=Math.max(1,Math.round(a)),i=u.Math.FloatBetween(-6,6),o=u.Math.FloatBetween(-6,6),n=this.scene.add.polygon(e+i,t+o,[0,-I,I,0,0,I,-I,0],6600182,.7);n.setOrigin(.5),n.setDepth(-.2),n.setStrokeStyle(1.2,16777215,.5),n.setData("xp",s),n.setData("baseSize",I),n.setData("magnetized",!1),n.setData("magnetSpeed",X),this.updateCrystalVisual(n),this.crystals.push(n)}update(e,t,a,s){const i=u.Math.Clamp(this.scene.game.loop.delta??16,8,48)/1e3;this.crystals=this.crystals.filter(o=>{if(!o.active)return o.destroy(),!1;o.getData("magnetized")||u.Math.Distance.Between(o.x,o.y,e,t)<=ue&&o.setData("magnetized",!0);const h=o.getData("magnetized");if(h){const r=o.getData("magnetSpeed")??X,l=e-o.x,m=t-o.y,p=Math.hypot(l,m)||1e-4,g=r*i;o.x+=l/p*g,o.y+=m/p*g}const c=u.Math.Distance.Between(o.x,o.y,e,t);if(h&&c<=ge){const r=Math.max(1,Math.round(o.getData("xp")??0));return o.destroy(),r>0&&s(r),!1}return!0}),this.mergeOutOfBounds(a,e,t)}destroyAll(){this.crystals.forEach(e=>e.destroy()),this.crystals=[]}activateMagnet(){this.crystals.forEach(e=>{e.active&&e.setData("magnetized",!0)})}mergeOutOfBounds(e,t,a){if(this.crystals.length<=K)return;const s=D;let i=0;for(;this.crystals.length>K&&i<20;){const o=this.crystals.filter(l=>l.x<e.left-s||l.x>e.right+s||l.y<e.top-s||l.y>e.bottom+s);if(o.length<2)break;o.sort((l,m)=>{const p=u.Math.Distance.Between(t,a,l.x,l.y);return u.Math.Distance.Between(t,a,m.x,m.y)-p});const n=o[0],h=o[1];if(!n.active||!h.active){[n,h].forEach(l=>{l.active||(l.destroy(),this.crystals=this.crystals.filter(m=>m!==l))}),i+=1;continue}const c=Math.max(0,Math.round(n.getData("xp")??0)),r=Math.max(0,Math.round(h.getData("xp")??0));n.setData("xp",c+r),n.setPosition((n.x+h.x)/2,(n.y+h.y)/2),this.updateCrystalVisual(n),h.destroy(),this.crystals=this.crystals.filter(l=>l!==h),i+=1}}updateCrystalVisual(e){const t=e.getData("xp")??0,a=e.getData("baseSize")??I,s=u.Math.Clamp(6+Math.sqrt(t)*1.1,6,28),i=s/a;e.setScale(i),e.setData("radius",s);const o=u.Math.Clamp(.45+t/180,.45,.9);e.setFillStyle(6600182,o),e.setStrokeStyle(1.2,16777215,.45+Math.min(.4,t/120))}}class fe{scene;enemies;constructor(e,t){this.scene=e,this.enemies=t}sync(e){this.enemies=e}spawn(e,t,a,s){const i=t.size/2,{x:o,y:n}=this.findSpawnPosition(e,i,s),h=B.mobWalk1,c=this.scene.add.sprite(o,n,b.key,h);return c.setOrigin(.5),c.setDisplaySize(t.size,t.size),c.setTint(a),c.setDepth(.1),c.setActive(!0),c.setData("mob",t),c.setData("hp",t.health),c.setData("lastHit",0),c.setData("lastAuraTick",0),c.setData("auraKnockback",40),c.setData("radius",i),this.scene.anims.exists("enemy-walk")&&(c.play("enemy-walk"),c.anims.setProgress(Math.random())),this.enemies.push(c),c}resolveOverlaps(){for(let e=0;e<this.enemies.length;e+=1){const t=this.enemies[e];if(!t.active)continue;const a=t.getData("mob");if(!a)continue;const s=a.size/2;for(let i=e+1;i<this.enemies.length;i+=1){const o=this.enemies[i];if(!o.active)continue;const n=o.getData("mob");if(!n)continue;const h=n.size/2,c=o.x-t.x,r=o.y-t.y,l=Math.hypot(c,r),m=s+h+2;if(l===0){const p=u.Math.FloatBetween(0,Math.PI*2);t.x+=Math.cos(p),t.y+=Math.sin(p),o.x-=Math.cos(p),o.y-=Math.sin(p),this.updateHpLabel(t,a),this.updateHpLabel(o,n);continue}if(l<m){const p=(m-l)/2,g=c/l,y=r/l;t.x-=g*p,t.y-=y*p,o.x+=g*p,o.y+=y*p,this.updateHpLabel(t,a),this.updateHpLabel(o,n)}}}}findSpawnPosition(e,t,a){const{heroX:s,heroY:i,halfWidth:o,halfHeight:n,buffer:h}=a;let c={x:s,y:i};const r=12;for(let l=0;l<r;l+=1){let m=0,p=0;switch(e){case 0:m=s+u.Math.FloatBetween(-o,o),p=i-n-h;break;case 1:m=s+o+h,p=i+u.Math.FloatBetween(-n,n);break;case 2:m=s+u.Math.FloatBetween(-o,o),p=i+n+h;break;default:m=s-o-h,p=i+u.Math.FloatBetween(-n,n);break}if(m+=u.Math.FloatBetween(-t,t),p+=u.Math.FloatBetween(-t,t),c={x:m,y:p},this.isPositionClear(m,p,t))break}return c}isPositionClear(e,t,a){for(const i of this.enemies){if(!i.active)continue;const o=i.getData("mob");if(!o)continue;const n=o.size/2;if(u.Math.Distance.Between(e,t,i.x,i.y)<a+n+6)return!1}return!0}updateHpLabel(e,t){const a=e.getData("hpText");!a||!a.active||a.setPosition(e.x,e.y-t.size/2-8)}}class we{scene;enemyManager;hooks;spawnBuffer;wave=0;running=!1;waveTimer;constructor(e,t,a,s){this.scene=e,this.enemyManager=t,this.spawnBuffer=a,this.hooks=s}start(){this.running||(this.running=!0,this.spawnWave(),this.waveTimer=this.scene.time.addEvent({delay:5e3,callback:this.spawnWave,callbackScope:this,loop:!0,startAt:0}))}stop(){this.running&&(this.running=!1,this.waveTimer?.remove(),this.waveTimer=void 0,this.wave=0)}isRunning(){return this.running}destroy(){this.stop()}spawnWave=()=>{const e=this.hooks.getHero();if(!e)return;this.wave+=1,this.hooks.onWaveAdvanced(this.wave);const t=Math.max(q+this.wave,10),a=u.Math.Between(0,3);this.spawnEnemy(1,e),this.spawnEnemy(1,e),this.spawnEnemy(2,e),this.spawnEnemy(2,e),this.spawnEnemy(3,e),this.spawnEnemy(3,e),this.spawnEnemy(4,e),this.spawnEnemy(4,e);for(let s=0;s<(t-8)/2;s+=1)this.spawnEnemy(a,e);for(let s=0;s<(t-8)/2;s+=1)this.spawnEnemy(a+1,e)};spawnEnemy(e,t){e=e%4;const a=1+this.wave/20,s=this.generateMobStats(a),i=s.damage/z*a,o=xe(.5+i/2,.4,.5+(1-i)/2),n=this.scene.cameras.main,h={heroX:t.sprite.x,heroY:t.sprite.y,halfWidth:n.width/2,halfHeight:n.height/2,buffer:this.spawnBuffer},c=this.enemyManager.spawn(e,s,o,h);this.hooks.onEnemySpawned(c,s)}generateMobStats(e){const t=Math.min(Q*e,U),a=w*e,s=z*e,i=.1,o=.1,n=.3,h=u.Math.FloatBetween(i,1),c=u.Math.FloatBetween(o,Math.max(.3,1-h)),r=Math.max(n,1+i+o-c-h),l=Math.round(r*t),m=Math.round(c*a),p=Math.round(h*s),g={size:C*2,speed:l,health:m,xp:0,damage:p},y=g.health/a+g.speed/t+g.damage/s;g.xp=Math.round(y)+1;const S=isNaN(Math.sqrt(g.health))?0:Math.round(Math.sqrt(g.health));return g.size=g.size+S,g}}function xe(d,e,t){const a=255*Math.min(Math.max(d,0),1),s=255*Math.min(Math.max(e,0),1),i=255*Math.min(Math.max(t,0),1);return a*65536&16711680|s*256&65280|i}function x(d){return{damage:w,cooldown:2,area:0,pierce:0,sectorAngle:120,...d}}const ye=x({damage:w*.5,cooldown:.3,pierce:1,area:6}),Me=x({damage:w*.8,cooldown:.28,pierce:2,area:6}),be=x({damage:w*1.1,cooldown:.26,pierce:3,area:6}),Se=x({damage:w*1.3,cooldown:.24,pierce:5,area:6}),ke=x({damage:w*2,cooldown:.22,pierce:8,area:6}),ve=x({damage:w*.5,cooldown:.5,area:_}),Ee=x({damage:w*.8,cooldown:.45,area:_*1.2}),Ae=x({damage:w*1.1,cooldown:.42,area:_*1.4}),De=x({damage:w*1.3,cooldown:.38,area:_*1.7}),Pe=x({damage:w*2,cooldown:.35,area:_*2}),Be=x({cooldown:5,damage:w*2,area:100}),Oe=x({cooldown:3,damage:w*4,area:150}),Ie=x({cooldown:2,damage:w*6,area:200}),He=x({cooldown:2,damage:w*1.2,area:50,sectorAngle:120}),_e=x({cooldown:1.8,damage:w*1.5,area:60,sectorAngle:130}),Te=x({cooldown:1.6,damage:w*1.7,area:70,sectorAngle:140}),Ue=x({cooldown:1.4,damage:w*2,area:80,sectorAngle:150}),We=x({cooldown:1.2,damage:w*2.5,area:90,sectorAngle:160}),Ne=[{id:"aura",label:"Unlock Aura",description:"Activate a damaging circle around you."},{id:"auraMk2",label:"Aura Mk II",description:"Aura deals more damage and ticks faster.",requires:["aura"]},{id:"auraMk3",label:"Aura Mk III",description:"Further improve aura damage and size.",requires:["auraMk2"]},{id:"auraMk4",label:"Aura Mk IV",description:"Aura grows stronger and covers more ground.",requires:["auraMk3"]},{id:"auraMk5",label:"Aura Mk V",description:"Maximum aura damage and reach.",requires:["auraMk4"]},{id:"pistol",label:"Equip Pistol",description:"Basic ranged damage with moderate fire rate."},{id:"pistolMk2",label:"Pistol Mk II",description:"Increase bullet damage and pierce.",requires:["pistol"]},{id:"pistolMk3",label:"Pistol Mk III",description:"Boost pistol power with extra pierce.",requires:["pistolMk2"]},{id:"pistolMk4",label:"Pistol Mk IV",description:"Fires faster with heavier rounds.",requires:["pistolMk3"]},{id:"pistolMk5",label:"Pistol Mk V",description:"Ultimate pistol damage and pierce.",requires:["pistolMk4"]},{id:"bomb",label:"Deploy Bombs",description:"Drop timed explosives dealing area damage."},{id:"bombMk2",label:"Bombs Mk II",description:"Bombs spawn faster with bigger blasts.",requires:["bomb"]},{id:"bombMk3",label:"Bombs Mk III",description:"Maximum bomb power and frequency.",requires:["bombMk2"]},{id:"sword",label:"Equip Sword",description:"Unlock a melee sword slash in your movement direction."},{id:"swordMk2",label:"Sword Mk II",description:"Sword swings faster and further.",requires:["sword"]},{id:"swordMk3",label:"Sword Mk III",description:"More sword damage with a wider arc.",requires:["swordMk2"]},{id:"swordMk4",label:"Sword Mk IV",description:"Sword reaches farther and swings quicker.",requires:["swordMk3"]},{id:"swordMk5",label:"Sword Mk V",description:"Maximum sword damage, arc, and speed.",requires:["swordMk4"]},{id:"area1",label:"Area +10%",description:"Increase area of effect by 10%"}],Re=new Set(["pistol","sword","aura","bomb"]);class Ce{scene;hero;combat;hooks;overlay=[];active=!1;constructor(e,t,a,s){this.scene=e,this.hero=t,this.combat=a,this.hooks=s}isActive(){return this.active}openMenu(){if(this.active)return!0;const e=this.getAvailableUpgrades();if(!e.length)return!1;this.active=!0,this.hooks.onMenuOpened(),this.clearOverlay();const{width:t,height:a}=this.scene.scale,s=t/2,i=a/2,o=Math.min(t-80,420),n=84,h=e.length*n+140,c=this.scene.add.rectangle(s,i,t,a,0,.55).setScrollFactor(0).setDepth(10).setInteractive();this.overlay.push(c);const r=this.scene.add.rectangle(s,i,o,h,2302778,.96).setScrollFactor(0).setDepth(11).setStrokeStyle(2,16771899,.5);this.overlay.push(r);const m=this.hero.weaponIds.length===0?"Choose Starting Weapon":"Choose Upgrade",p=this.scene.add.text(s,i-h/2+40,m,{color:"#ffe082",fontFamily:"monospace",fontSize:"22px"}).setOrigin(.5).setScrollFactor(0).setDepth(12);return this.overlay.push(p),e.forEach((g,y)=>{const S=i-h/2+88+y*n,M=this.scene.add.text(s,S,g.label,{color:"#f5f5f5",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#30304a",padding:{x:16,y:10}}).setOrigin(.5).setScrollFactor(0).setDepth(12).setInteractive({useHandCursor:!0});M.on("pointerover",()=>M.setStyle({backgroundColor:"#3d3d5c"})),M.on("pointerout",()=>M.setStyle({backgroundColor:"#30304a"})),M.on("pointerdown",()=>this.applyUpgrade(g.id)),this.overlay.push(M);const W=this.scene.add.text(s,S+28,g.description,{color:"#b0bec5",fontFamily:"monospace",fontSize:"16px"}).setOrigin(.5,0).setScrollFactor(0).setDepth(12);this.overlay.push(W)}),!0}destroy(){this.clearOverlay()}applyUpgrade(e){switch(this.hero.upgrades.includes(e)||this.hero.upgrades.push(e),e){case"aura":this.handleAuraUpgrade(ve,"Aura weapon activated!");break;case"auraMk2":this.handleAuraUpgrade(Ee,"Aura Mk II empowered!");break;case"auraMk3":this.handleAuraUpgrade(Ae,"Aura Mk III intensified!");break;case"auraMk4":this.handleAuraUpgrade(De,"Aura Mk IV radiates farther!");break;case"auraMk5":this.handleAuraUpgrade(Pe,"Aura Mk V unleashed!");break;case"pistol":this.handlePistolUpgrade(ye,"Pistol ready!");break;case"pistolMk2":this.handlePistolUpgrade(Me,"Pistol Mk II ready!");break;case"pistolMk3":this.handlePistolUpgrade(be,"Pistol Mk III ready!");break;case"pistolMk4":this.handlePistolUpgrade(Se,"Pistol Mk IV ready!");break;case"pistolMk5":this.handlePistolUpgrade(ke,"Pistol Mk V ready!");break;case"bomb":this.handleBombUpgrade(Be,"Bomb launcher deployed!");break;case"bombMk2":this.handleBombUpgrade(Oe,"Bombs Mk II primed!");break;case"bombMk3":this.handleBombUpgrade(Ie,"Bombs Mk III unleashed!");break;case"sword":this.handleSwordUpgrade(He,"Sword technique mastered!");break;case"swordMk2":this.handleSwordUpgrade(_e,"Sword Mk II swings wider!");break;case"swordMk3":this.handleSwordUpgrade(Te,"Sword Mk III hits harder!");break;case"swordMk4":this.handleSwordUpgrade(Ue,"Sword Mk IV extends reach!");break;case"swordMk5":this.handleSwordUpgrade(We,"Sword Mk V slices everything!");break}this.hooks.onUpgradeApplied(),this.closeMenu()}closeMenu(){this.clearOverlay(),this.active=!1,this.hooks.onMenuClosed()}clearOverlay(){this.overlay.forEach(e=>e.destroy()),this.overlay=[]}getAvailableUpgrades(){const e=this.hero.weaponIds.length===0;return Ne.filter(t=>this.hero.upgrades.includes(t.id)||t.requires&&!t.requires.every(a=>this.hero.upgrades.includes(a))?!1:e?Re.has(t.id):!0)}handleAuraUpgrade(e,t){this.hero.hasAura=!0,this.hero.weaponIds.includes("aura")||this.hero.weaponIds.push("aura"),this.hero.aura.setVisible(!0),this.hero.aura.setRadius(e.area),this.combat.setAuraWeapon(e),this.hooks.onShowMessage(t)}handlePistolUpgrade(e,t){this.hero.weaponIds.includes("pistol")||this.hero.weaponIds.push("pistol"),this.combat.setPistolWeapon(e),this.hooks.onShowMessage(t)}handleBombUpgrade(e,t){this.hero.weaponIds.includes("bomb")||this.hero.weaponIds.push("bomb"),this.combat.setBombWeapon(e),this.hooks.onShowMessage(t)}handleSwordUpgrade(e,t){this.hero.weaponIds.includes("sword")||this.hero.weaponIds.push("sword"),this.combat.setSwordWeapon(e),this.hooks.onShowMessage(t)}}const Fe=T*.3,N={duration:100,r:120,g:200,b:255},R={duration:100,r:80,g:180,b:255},E=C*3;class Le{scene;xpManager;hooks;healPacks=[];magnetPickups=[];constructor(e,t,a){this.scene=e,this.xpManager=t,this.hooks=a}spawnHealPack(e){const t=u.Math.FloatBetween(e.left+E,e.right-E),a=u.Math.FloatBetween(e.top+E,e.bottom-E),s=v,i=this.scene.add.image(t,a,b.key,B.healPotion);i.setDisplaySize(s,s),i.setTint(15753280),i.setData("radius",s/2),this.healPacks.push(i)}spawnMagnetPickup(e){if(this.magnetPickups.some(o=>o.active))return;const t=u.Math.FloatBetween(e.left+E,e.right-E),a=u.Math.FloatBetween(e.top+E,e.bottom-E),s=v,i=this.scene.add.image(t,a,b.key,B.portalOpens);i.setDisplaySize(s,s),i.setTint(4367861),i.setData("radius",s/2),i.setDepth(.2),this.magnetPickups.push(i)}update(e){const t=this.hooks.getHero(),a=t.sprite,s=t.radius,i=a.x,o=a.y;this.healPacks=this.healPacks.filter(n=>{if(!n.active)return n.destroy(),!1;const h=n.getData("radius")??v/2;return u.Math.Distance.Between(n.x,n.y,i,o)<h+s?(this.collectHealPack(n),!1):this.isOutOfBounds(n.x,n.y,e)?(n.destroy(),!1):!0}),this.magnetPickups=this.magnetPickups.filter(n=>{if(!n.active)return n.destroy(),!1;const h=n.getData("radius")??v/2;return u.Math.Distance.Between(n.x,n.y,i,o)<h+s?(this.collectMagnetPickup(n),!1):this.isOutOfBounds(n.x,n.y,e)?(n.destroy(),!1):!0})}destroy(){this.healPacks.forEach(e=>e.destroy()),this.healPacks=[],this.magnetPickups.forEach(e=>e.destroy()),this.magnetPickups=[]}collectHealPack(e){const t=this.hooks.getHero();le(t,Fe),this.scene.cameras.main.flash(R.duration,R.r,R.g,R.b,!1),e.destroy(),this.hooks.onHeroHealed()}collectMagnetPickup(e){this.xpManager.activateMagnet(),this.scene.cameras.main.flash(N.duration,N.r,N.g,N.b,!1),e.destroy(),this.hooks.onMagnetActivated()}isOutOfBounds(e,t,a){const s=D;return e<a.left-s||e>a.right+s||t<a.top-s||t>a.bottom+s}}class P extends u.Scene{static exitHandler;hero;inputController;enemies=[];spawnBuffer=C*6;background;worldBounds=Z;infoText;kills=0;wave=0;combat;xpManager;enemyManager;waveManager;pickupManager;upgradeManager;pauseButton;exitButton;isPaused=!1;totalXp=0;level=1;nextLevelXp=100;pendingLevelUps=0;supportTimersStarted=!1;pickupTimers=[];static registerExitHandler(e){P.exitHandler=e}preload(){this.textures.exists(b.key)||this.load.spritesheet(b.key,b.url,{frameWidth:b.frameWidth,frameHeight:b.frameHeight,spacing:b.spacing})}create(){const{width:e,height:t}=this.scale;if(this.cameras.main.setBackgroundColor("#101014"),this.time.timeScale=1,this.isPaused=!1,!this.textures.exists("hordes-grid")){const s=this.add.graphics();s.setVisible(!1),s.fillStyle(1118493,1),s.fillRect(0,0,96,96),s.lineStyle(2,1908012,.6),s.strokeRect(0,0,96,96),s.lineStyle(1,2041148,.5),s.beginPath(),s.moveTo(48,0),s.lineTo(48,96),s.moveTo(0,48),s.lineTo(96,48),s.strokePath(),s.generateTexture("hordes-grid",96,96),s.destroy()}this.background=this.add.tileSprite(e/2,t/2,e,t,"hordes-grid"),this.background.setOrigin(.5),this.background.setScrollFactor(0),this.background.setDepth(-2),this.hero=re(this),this.enemies=[],this.xpManager=new me(this),this.pickupManager=new Le(this,this.xpManager,{getHero:()=>this.hero,onHeroHealed:()=>this.updateHud(),onMagnetActivated:()=>{this.showMagnetPickup(),this.updateHud()}}),this.enemyManager=new fe(this,this.enemies),this.waveManager=new we(this,this.enemyManager,this.spawnBuffer,{getHero:()=>this.hero,onEnemySpawned:(s,i)=>this.attachEnemyHpOverlay(s,i),onWaveAdvanced:s=>{this.wave=s,this.updateHud()}}),this.ensureEnemyWalkAnimation(),this.kills=0,this.wave=0,this.totalXp=0,this.level=1,this.nextLevelXp=this.getNextLevelXp(this.level),this.pendingLevelUps=0,this.hero.hasAura=!1,this.hero.aura.setVisible(!1),this.inputController=pe(this),this.combat=new ne(this,{pistolWeapon:null,auraWeapon:null,bombWeapon:null,swordWeapon:null},{hero:this.hero,getEnemies:()=>this.enemies,onEnemyKilled:(s,i)=>{this.kills+=1,this.xpManager.spawn(s.x,s.y,i.xp)}}),this.upgradeManager=new Ce(this,this.hero,this.combat,{onMenuOpened:()=>this.pauseForUpgrade(),onMenuClosed:()=>this.onUpgradeMenuClosed(),onUpgradeApplied:()=>this.updateHud(),onShowMessage:s=>this.showWeaponUpgrade(s)}),this.events.once(u.Scenes.Events.SHUTDOWN,()=>{this.combat.reset(),this.inputController.destroy(),this.xpManager.destroyAll(),this.upgradeManager.destroy(),this.pickupManager.destroy(),this.waveManager.destroy(),this.clearSupportTimers()});const a=this.cameras.main;a.setBounds(-this.worldBounds,-this.worldBounds,this.worldBounds*2,this.worldBounds*2),a.startFollow(this.hero.sprite,!0,1,1),a.centerOn(0,0),this.infoText=this.add.text(16,16,"Wave 0",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px"}).setDepth(2),this.infoText.setScrollFactor(0),this.updateHud(),this.pauseButton=this.add.text(e-16,16,"Pause",{color:"#f5f5f5",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#30304888",padding:{x:8,y:4}}).setOrigin(1,0).setDepth(2).setScrollFactor(0).setInteractive({useHandCursor:!0}),this.pauseButton.on("pointerdown",()=>this.togglePause()),this.exitButton=this.add.text(e-16,this.pauseButton.y+this.pauseButton.displayHeight+12,"Exit",{color:"#ff8a80",fontFamily:"monospace",fontSize:"18px",backgroundColor:"#30304888",padding:{x:8,y:4}}).setOrigin(1,0).setDepth(2).setScrollFactor(0).setInteractive({useHandCursor:!0}),this.exitButton.on("pointerdown",()=>this.handleExit()),this.hero.weaponIds.length===0?(this.pendingLevelUps=Math.max(this.pendingLevelUps,1),this.tryOpenUpgradeMenu()):this.maybeStartWaves()}update(e,t){const a=t/1e3,s=this.hero.radius;if(this.isPaused)return;const i=this.inputController.getDirection();he(this.hero,i,U,a);const o=this.cameras.main;this.background.tilePositionX=o.scrollX,this.background.tilePositionY=o.scrollY;const n=this.hero.sprite.x,h=this.hero.sprite.y,c=this.cameras.main.worldView;this.enemies=this.enemies.filter(r=>{const l=r.getData("mob");if(!r.active||!l)return!1;const m=l.size/2,p=n-r.x,g=h-r.y,y=Math.hypot(p,g)||.001,S=l.speed;r.x+=p/y*S*a,r.y+=g/y*S*a,p!==0&&r.setFlipX(p<0),this.positionEnemyHpText(r,l),y<s+m&&this.handleHeroHit(r,l);const M=D+m;return r.x<c.left-M||r.x>c.right+M||r.y<c.top-M||r.y>c.bottom+M?(r.destroy(),!1):r.active}),this.enemyManager.sync(this.enemies),this.combat.update(a,c),this.xpManager.update(n,h,c,r=>this.awardXp(r)),this.pickupManager.update(c),this.enemyManager.resolveOverlaps()}maybeStartWaves(){this.hero.weaponIds.length!==0&&(this.waveManager.isRunning()||(this.waveManager.start(),this.startSupportTimers()))}startSupportTimers(){if(this.supportTimersStarted)return;this.supportTimersStarted=!0;const e=this.time.addEvent({delay:1e4,callback:()=>this.pickupManager.spawnHealPack(this.cameras.main.worldView),loop:!0,startAt:4e3}),t=this.time.addEvent({delay:6e4,callback:()=>this.pickupManager.spawnMagnetPickup(this.cameras.main.worldView),loop:!0,startAt:0});this.pickupTimers.push(e,t)}clearSupportTimers(){this.pickupTimers.forEach(e=>e.remove()),this.pickupTimers=[],this.supportTimersStarted=!1}attachEnemyHpOverlay(e,t){const a=this.add.text(e.x,e.y,`${t.health}`,{color:"#ffffff",fontFamily:"monospace",fontSize:"12px"}).setOrigin(.5).setDepth(1);e.setData("hpText",a),e.once("destroy",()=>a.destroy()),this.positionEnemyHpText(e,t)}positionEnemyHpText(e,t){const a=e.getData("hpText");!a||!a.active||a.setPosition(e.x,e.y-t.size/2-8)}handleHeroHit(e,t){if(this.hero.hp<=0)return;const a=this.time.now,s=e.getData("lastHit");if(s&&a-s<1e3)return;e.setData("lastHit",a);const i=t.damage,o=ce(this.hero,i);this.cameras.main.flash(120,255,64,64,!1),this.updateHud(),o<=0&&(this.cameras.main.shake(250,.02),this.time.delayedCall(260,()=>this.handleExit()))}awardXp(e){if(e>0){for(this.totalXp+=e;this.totalXp>=this.nextLevelXp;)this.level+=1,this.pendingLevelUps+=1,this.showLevelUp(),this.nextLevelXp+=this.getNextLevelXp(this.level);this.tryOpenUpgradeMenu()}this.updateHud()}tryOpenUpgradeMenu(){if(this.pendingLevelUps<=0||this.upgradeManager.isActive())return;if(!this.upgradeManager.openMenu()){this.pendingLevelUps=0;return}this.pendingLevelUps-=1}handleExit(){const e=P.exitHandler;e&&e({kills:this.kills,waves:this.wave})}pauseForUpgrade(){this.isPaused=!0,this.time.timeScale=0,this.pauseButton&&(this.pauseButton.disableInteractive(),this.pauseButton.setText("Upgrade"))}resumeFromUpgrade(){this.isPaused=!1,this.time.timeScale=1,this.pauseButton&&(this.pauseButton.setText("Pause"),this.pauseButton.setInteractive({useHandCursor:!0}))}onUpgradeMenuClosed(){this.resumeFromUpgrade(),this.pendingLevelUps>0&&this.tryOpenUpgradeMenu(),this.upgradeManager.isActive()||this.maybeStartWaves()}showLevelUp(){const e=this.add.text(this.scale.width/2,96,`Level ${this.level}!`,{color:"#ffe082",fontFamily:"monospace",fontSize:"24px",backgroundColor:"#1a1a25bb",padding:{x:12,y:6}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:e,alpha:0,y:e.y-32,duration:900,ease:"Sine.easeOut",onComplete:()=>e.destroy()}),this.cameras.main.flash(160,140,220,80,!1)}showWeaponUpgrade(e){const t=this.add.text(this.scale.width/2,140,e,{color:"#ffab40",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#222234dd",padding:{x:10,y:4}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:t,alpha:0,y:t.y-28,duration:900,ease:"Sine.easeOut",onComplete:()=>t.destroy()})}showMagnetPickup(){const e=this.add.text(this.scale.width/2,180,"Magnet activated!",{color:"#8c9eff",fontFamily:"monospace",fontSize:"20px",backgroundColor:"#1f1f32dd",padding:{x:10,y:4}}).setOrigin(.5).setScrollFactor(0).setDepth(5);this.tweens.add({targets:e,alpha:0,y:e.y-24,duration:900,ease:"Sine.easeOut",onComplete:()=>e.destroy()})}getNextLevelXp(e){return Math.ceil(te*Math.pow(se,e-1))}togglePause(){this.upgradeManager.isActive()||(this.isPaused=!this.isPaused,this.pauseButton.setText(this.isPaused?"Resume":"Pause"),this.time.timeScale=this.isPaused?0:1)}updateHud(){this.infoText.setText(`Wave ${this.wave} | HP ${this.hero.hp} | LVL ${this.level} (${this.totalXp}/${this.nextLevelXp})
Weapons: ${this.hero.weaponIds} | Kills ${this.kills}`)}ensureEnemyWalkAnimation(){if(!this.textures.exists(b.key)||this.anims.exists("enemy-walk"))return;const e=[B.mobWalk1,B.mobWalk2].map(t=>({key:b.key,frame:t}));this.anims.create({key:"enemy-walk",frames:e,frameRate:6,repeat:-1})}}const ze={type:u.AUTO,width:800,height:600,backgroundColor:"#101014",scene:P,fps:{target:60},scale:{mode:u.Scale.RESIZE,autoCenter:u.Scale.CENTER_BOTH}},G="hordesHighScores",Y=5,Ve=()=>{try{const d=window.localStorage.getItem(G);if(!d)return[];const e=JSON.parse(d);return Array.isArray(e)?e.filter(t=>typeof t?.kills=="number"&&typeof t?.waves=="number"&&typeof t?.timestamp=="number").sort((t,a)=>a.kills!==t.kills?a.kills-t.kills:a.waves!==t.waves?a.waves-t.waves:a.timestamp-t.timestamp).slice(0,Y):[]}catch(d){return console.warn("Failed to read Hordes high scores",d),[]}},je=d=>{if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(G,JSON.stringify(d))}catch(e){console.warn("Failed to save Hordes high scores",e)}},Xe=(d,e)=>{const t=[...d,{...e,timestamp:Date.now()}];return t.sort((a,s)=>s.kills!==a.kills?s.kills-a.kills:s.waves!==a.waves?s.waves-a.waves:s.timestamp-a.timestamp),t.slice(0,Y)},Ge=()=>{const d=k.useRef(null),e=k.useRef(null),[t,a]=k.useState(!1),[s,i]=k.useState(null),[o,n]=k.useState([]);k.useEffect(()=>{n(Ve())},[]);const h=k.useCallback(r=>{i(r),a(!1),n(l=>{const m=Xe(l,r);return je(m),m})},[]);k.useEffect(()=>{if(!t){P.registerExitHandler(void 0),e.current&&(e.current.destroy(!0),e.current=null);return}const r=d.current;if(!r)return;P.registerExitHandler(h);const l=new u.Game({parent:r,...ze});e.current=l;const m=()=>{const g=r.clientWidth,y=r.clientHeight;g&&y&&l.scale.resize(g,y)};m();let p;return typeof ResizeObserver<"u"&&(p=new ResizeObserver(m),p.observe(r)),()=>{P.registerExitHandler(void 0),p?.disconnect(),l.destroy(!0),e.current=null}},[h,t]);const c=k.useCallback(()=>{i(null),a(!0)},[]);return t?f.jsx("div",{className:"h-screen w-screen overflow-hidden bg-[#101014] text-gray-100",children:f.jsx("div",{ref:d,className:"h-full w-full"})}):f.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-start bg-gray-900 px-6 py-6 text-gray-100",children:[f.jsx("h1",{className:"mb-4 text-3xl font-semibold",children:"Hordes"}),f.jsx("div",{className:"flex w-full max-w-[1100px] flex-col gap-6 lg:flex-row",children:f.jsxs("div",{className:"flex-1 rounded-lg border border-[#252545] bg-[#161626] p-5",children:[f.jsx("h2",{className:"mb-3 text-xl font-semibold",children:"High Scores"}),o.length===0?f.jsx("p",{className:"text-sm opacity-70",children:"No runs recorded yet. Be the first!"}):f.jsxs("table",{className:"w-full border-collapse text-sm",children:[f.jsx("thead",{children:f.jsxs("tr",{className:"border-b border-[#2c2c45] text-left",children:[f.jsx("th",{className:"px-1 py-1",children:"#"}),f.jsx("th",{className:"px-1 py-1",children:"Kills"}),f.jsx("th",{className:"px-1 py-1",children:"Waves"}),f.jsx("th",{className:"px-1 py-1",children:"Date"})]})}),f.jsxs("tbody",{children:[s&&f.jsxs("tr",{children:[f.jsx("td",{className:"px-1 py-1",children:"Last"}),f.jsx("td",{className:"px-1 py-1",children:s?.kills}),f.jsx("td",{className:"px-1 py-1",children:s?.waves})]}),o.map((r,l)=>f.jsxs("tr",{className:"border-b border-white/5",children:[f.jsx("td",{className:"px-1 py-2",children:l+1}),f.jsx("td",{className:"px-1 py-2",children:r.kills}),f.jsx("td",{className:"px-1 py-2",children:r.waves}),f.jsx("td",{className:"px-1 py-2",children:new Date(r.timestamp).toLocaleDateString()})]},`${r.timestamp}-${l}`))]})]}),f.jsx("button",{onClick:c,className:"mt-4 w-full rounded-md bg-green-600 px-4 py-2 text-base font-semibold text-white transition hover:bg-green-500",children:"Play"})]})})]})};export{Ge as default};
